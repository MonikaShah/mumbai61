{% extends 'map/map_base.html' %}
{% load static%}{% load has_group %}
{% block extra_map_css %}
{% load i18n %}


<!-- import psycopg2 -->
<style>
  .border {
    padding: 6px 8px;
    border-style: groove;
    border-radius: 5px;
    margin: 20px;
  }

  .info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    border-radius: 5px;
  }

  .info h4 {
    margin: 0 0 5px;
    color: #777;
  }

  /* .table{
  border-collapse: collapse;
  padding: 50px;
  font-weight: bold;

  
  /* background:rgba(191, 149, 233, 0.473); */

  /* } */


  /* table{
    width: 350px;
  } */
  th {
    border-bottom: 1px solid #ddd;
    border-collapse: collapse;
    width: 150px !important;
    /* padding: 2px 3px; */
    /* text-align: center; */
  }

  td {
    border-bottom: 1px solid #ddd;
    border-collapse: collapse;
    width: 250px !important;
    /* padding: 2px 3px; */
    /* text-align: center; */
  }
  table{
    border-bottom: 1px solid #ddd;
    border-collapse: collapse;
    width: 450px !important;
    /* padding: 2px 3px; */
    /* text-align: center; */
  }

  th {
    font-weight: bold;
  }

  .legend {
    line-height: 18px;
    color: #555;
  }

  .legend i {

    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
  }

  .legendwet {
    line-height: 18px;
    color: #555;
  }

  .legendwet i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
  }

  /* css to customize Leaflet default styles  */
  .leaflet-popup-content-wrapper {
    width: 500px;
    background: rgba(0, 0, 0, 0.9);
    color: #ffffff;
  }

  .leaflet-popup-content {
    font-weight: bold;
  }

  /* css for table tbinfo*/
  #tbinfo {
    font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
    border-collapse: collapse;
    font-weight: bolder;
  }

  #tbinfo td,
  #tbinfo th {
    border: 3px solid #ddd;
    /* padding: 8px; */
  }

  #tbinfo tr:nth-child(even) {
    background-color: #f2f2f2;
  }

  #tbinfo tr:hover {
    background-color: rgb(194, 92, 92);
  }

  #tbinfo th {
    padding-top: 12px;
    padding-bottom: 12px;
    text-align: left;
    background-color: #4CAF50;
    color: white;
  }

  #checkboxes,#checkboxes1 {
    display: none;
    /* border: 1px #dadada solid; */
  }

  #datepick {
    display: none;
    /* border: 1px #dadada solid; */
  }
#side-bar{
  min-height: min-content;
  max-height: 100%;
  margin: 0;
  overflow-y: scroll;
}
  #checkboxes label,#checkboxes1 label {
    display: block;
    text-decoration-color: blue;
    text-align: left;
    margin: 10px;
  }
#formBtn{
  background-color: rgb(131, 131, 241);
}

  #checkboxes8,#checkboxes9,#checkboxes10,#checkboxes11,#checkboxes12,#checkboxes13{
    display: none;
    /* border: 1px #dadada solid; */
  }

  .legend{
    background-color: white;
  }
  #checkboxes8 label,#checkboxes9 label, #checkboxes10 label,#checkboxes11 label,#checkboxes12 label,#checkboxes13 label {
    display: block;
    text-decoration-color: blue;
    text-align: left;
    margin: 10px;
  }

  #checkboxes3,#mumbai_whole,#ward_check {
    display: none;
    /* border: 1px #dadada solid; */
  }

  #checkboxes3 label {
    display: block;
    background-color: white;
    text-decoration-color: blue;
    text-align: left;
    margin: 10px;
  }

  #checkboxes7 {
    display: none;
    /* border: 1px #dadada solid; */
  }

  #kwestbuilding,#ward_checklist {
    display: none;

  }

  #checkboxes7 label,#mumbai_whole label,#ward_check label,#ward_check select {
    display: block;
    text-align: left;
    margin: 10px;
  }
  .required:after {
    content:" *";
    color: rgb(251, 4, 4);
    /* size:"6px"; */
    font-size:x-large;
    
  }
  
  /* Popup container - can be anything you want */
  .popup {
    position: relative;
    display: inline-block;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    left: 50%;
    margin-right: -5px;
    border-width: 5px;
  }

  /* The actual popup */
  .popup .popuptext {
    visibility: hidden;
    width: 260px;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px 0;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -80px;
  }

  /* Popup arrow */
  .popup .popuptext::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #555 transparent transparent transparent;
  }

  /* Toggle this class - hide and show the popup */
  .popup .show {
    visibility: visible;
    -webkit-animation: fadeIn 1s;
    animation: fadeIn 1s;
  }

  /* Add animation (fade in the popup) */
  @-webkit-keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  .form-control {
    width: 160px;
  }

  .circle {
    /* background-color: red; */
    border-radius: 50%;
  }
  .tab4 {
            tab-size: 8;
        }
/* Grey text boc for sac no to be read only in garbage revised form */
.grey-textbox {
    background-color: #d3d3d3; /* Use the desired shade of grey */
    /* Add any additional styling as needed */
}
</style>

{% endblock extra_map_css%}

{% block map_content%}
<!-- {% block sidebar %}
  {% endblock %} -->
  {% if messages %}
  <div>
  <ul class="messages">
      {% for message in messages %}
  
      <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{message}}
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
      </div>
  
      {% endfor %}
  </ul>
  </div>
  {% endif %}

<div id="side-bar" style="background-color:  rgba(255, 255, 255);">
  <!-- side-bar container -->

  <div class="mobileShow">

    <div style="text-align: center">
      <button style="display: inline-block ;position: relative; background: #000; opacity: 0.60;" id="closebutton"
        name="closebutton" class="btn btn-secondary"><span class="fa fa-bars"></span></button>
    </div>

  </div>
  <div>
    <div class="text-center border">


      <form id="projectList" style="width: 100%">

        <form>
          <div class="multiselect">
          <div class="selectBox" onclick="showCheckboxes3('mumbai')">
            <button type="button" class="btn btn-outline-dark" style="width: 90%;font-size:12px; "> {% trans "Mumbai Layers" %}</button>
            <div class="overSelect"></div>
          </div>

         
              <div id="mumbai_whole">
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{mumbai_ward}" id="mumbai_ward" onchange="getBoundaryru(this)"><span> {% trans "Ward Boundaries" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{mumbai_prabhag}" id="mumbai_prabhag" onchange="getBoundaryru(this)"><span> {% trans "Prabhag Boundaries" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;" value="{mumbai_buildings}" id="mumbai_buildings" onclick="getBoundaryru(this)"><span> {% trans "Building points :Whole Mumbai" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;" value="{DP}" id="DP" onclick="putDP()"><span> {% trans "Development Plan :Whole Mumbai" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;" value="{mumbai_roads}" id="mumbai_roads" onclick="getBoundaryru(this)"><span> {% trans "Road Network :Whole Mumbai" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;" value="{mumbai_waterbodies}" id="mumbai_waterbodies" onclick="getBoundaryru(this)"><span> {% trans "Nallah's" %}</span></label>
                </div>
                <hr><label for="" style="margin: 0 0 0 37px; font-weight: bolder;">Building Points: Selected Parts</label>
              <label for="" style="text-align: center; font-weight: bolder;">Ward wise</label>
              <select class="custom-select" name="dist_select" id="wardlistwms"> 
                <option selected disabled>Select ward</option>
                {% for dist_select in ward_list %}
                <option value="{{ dist_select.ward_id }}">{{ dist_select.ward_name_field }}
                </option>
                {% endfor %}
            </select>
            <label for=""  style="text-align: center; font-weight: bolder;">Prabhag wise</label>
            <select class="custom-select" name="dist_select" id="prabhaglistwms">
              <option selected disabled>Select Prabhag</option>
              <!-- {% for dist_select in prabhag_mumbai %}
              <option value="{{ dist_select.prabhag_no }}">{{ dist_select.prabhag_no }}
              </option>
              {% endfor %} -->
          </select><hr>
        </div>
        <br>
        <!-- Focus N ward  -->
        <div class="multiselect">
          <div class="selectBox" onclick="showCheckboxes3('geoN')">
            <button type="button" class="btn btn-outline-dark addMore" title = "More interactions are enable here  as a Pilot area"style="width: 90%;font-size:12px; " title="More interactions have been enable here  as a Pilot area"> {% trans "Focus: N Ward" %}</button>
            <div class="overSelect"></div>
          </div>
          
           <div id="checkboxes10">
            <label style="color:green;font-weight: bold;">{% trans "Geography" %}</label>
              <div class="checkbox" id="boundary">
              <label><input type="checkbox" value="{wardN}" id ="wardN" onchange="getBoundaryru(this)"><span> {% trans "N Ward Boundary" %}</span></label>
              
            <div class="checkbox">
              <label><input type="checkbox"  value="{Nwardprabhags}" id = "Nwardprabhags" onchange="getBoundaryru(this)"><span> {% trans "Prabhags" %}</span></label>
            </div>
            <label style="color:green;font-weight: bold;">{% trans "Roads and routes" %}</label>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Nroads}"  id="Nroads"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Roads" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Nmor_routes}"  id="Nmor_routes"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Morning Routes" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Nveg_routes}"  id="Nveg_routes"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Vegetable Market Routes" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Ndebris_routes}"  id="Ndebris_routes"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Debris Routes" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Nhotel_routes}"  id="Nhotel_routes"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Hotel Routes" %}</span></label>
              </div>
            </div>
            <label style="color:green;font-weight: bold;">{% trans "Building Data" %}</label>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{nbuildings}"  id="nbuildings"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Buildings" %}</span></label>
              </div>
            </div>
            
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{n132staticcount}"  id="132"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 132 : Buildings Info (static data)" %}</span></label>
              </div>
            </div>
            <label style="color:green;font-weight: bold;">{% trans "Students case Studies" %}</label>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{n132composting}"  id="n132composting"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 132 : Buildings doing composting" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{nbuildings}"  id="nbuildings"
                    onchange="getBoundaryru(this)" disabled><span> {% trans "Prabhag 132 : Bulk Waste Generator" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{n132gardens}"  id="n132gardens"
                    onchange="getBoundaryru(this)" ><span> {% trans "Prabhag 132 : Gardens" %}</span></label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{n132seg}"  id="n132seg"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 132 : Segregation Activity" %}</span><label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{n132segqual}"  id="n132segqual"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 132 : Segregation Quality" %}</span><label>
              </div>
            </div>
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{n132segfreq}"  id="n132segfreq"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 132 : Segregation Frequency" %}</span><label>
              </div>
            </div>

          </div>
        </div> 
         <br> 
        <!--------------- Focus Powai Lake Neighbours L ward--------------------->
        {% if request.user.is_authenticated%}
        <div class="multiselect">
          <div class="selectBox" onclick="showCheckboxes3('geoL')">
            <button type="button" class="btn btn-outline-dark addMore" title = "More interactions are enable here  as a Pilot area"style="width: 90%;font-size:12px; " title="L ward"> {% trans "Focus: L Ward" %}</button>
            <div class="overSelect"></div>
          </div>
           <div id="checkboxes13">
            <!-- <div class="checkbox" id="boundary">
              <label><input type="checkbox" value="Mumbai Suburban" onchange="getBoundaryru(this)"><span> {% trans  "Mumbai Suburban Boundary" %}</span></label>
            </div> -->
            
            <div class="checkbox" id="boundary">
              <label><input type="checkbox" value="{wardL}" id ="wardL" onchange="getBoundaryru(this)"><span> {% trans "L Ward Boundary" %}</span></label>
              
            <div class="checkbox">
              <label><input type="checkbox"  value="{Lwardprabhags}" id = "Lwardprabhags" onchange="getBoundaryru(this)"><span> {% trans "Prabhags" %}</span></label>
            </div>
           
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Lroads}"  id="Lroads" 
                    onchange="getBoundaryru(this)"><span> {% trans "L-ward Roads" %}</span></label>
              </div>
            </div>
            
              
            <!-- <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{Nmor_routes}"  id="Nmor_routes"
                    onchange="getBoundaryru(this)"><span> {% trans "N-ward Morning Routes" %}</span></label>
              </div>
            </div> -->
            <div id="checkboxes4">
              <div class="checkbox">
                <label><input type="checkbox" value="{lbuildings}"  id="lbuildings" disabled
                    onchange="getBoundaryru(this)"><span> {% trans "L-ward Buildings" %}</span></label>
              </div>
            </div>
            <label><b> <font color ='green'>Prabhag 156 and 157</font></b>  
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox"  value="{156bound}" id = "bound156" onchange="getBoundaryru(this)"><span> {% trans "Prabhag 156 Boundary" %}</span></label>
              </div>
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox" value="{l156buildings}"  id="l156buildings"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 156: Buildings" %}</span></label>
              </div>
              <hr>
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox"  value="{157bound}" id = "bound157" onchange="getBoundaryru(this)"><span> {% trans "Prabhag 157 Boundary" %}</span></label>
              </div>
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox" value="{l157buildings}"  id="l157buildings"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag 157: Buildings" %}</span></label>
              </div>
          </div>
        </div> 
         <br> 
         {% endif %}
        <!--Focus case StudiesPrabhag 122-->
        
        <div class="multiselect">
          <div class="selectBox" onclick="showCheckboxes3('geoCS')">
            <button type="button" class="btn btn-outline-dark addMore" title = "More interactions are enable here" style="width: 90%;font-size:12px; " title="More interactions have been enabled here."> {% trans "Prabhag122: Case Studies" %}</button>
            <div class="overSelect"></div>
            
          </div>
          
           <div id="checkboxes12">
              <label style="color:green;font-weight: bold;">{% trans "Building Wise" %}</label>
             <div class="checkbox">
              <label><input type="checkbox" value="{segdone}" id ="segdone" 
                onchange="getBoundaryru(this)">
                <span> {% trans "Segregation Activity" %}</span></label>
              </div>
            
            
              <div class="checkbox">
              <label><input type="checkbox"  value="{segquality}" id = "segquality" onchange="getBoundaryru(this)"><span> {% trans "Segregation Quality" %}</span></label>
              </div>

              <div class="checkbox">
                <label><input type="checkbox" value="{segcons}" id ="segcons" onchange="getBoundaryru(this)">
                  <span> {% trans "Segregation consistency" %}</span></label>
                </div>   
              
                <div class="checkbox">
                <label><input type="checkbox"  value="{segfreq}" id = "segfreq" onchange="getBoundaryru(this)"><span> {% trans "Waste pick up frequency" %}</span></label>
                </div>

                <div class="checkbox">
                  <label><input type="checkbox" value="{description}" id ="description" onchange="getBoundaryru(this)">
                    <span> {% trans "Building Description" %}</span></label>
                  </div>
            
           
              <label style="color:green;font-weight: bold;">{% trans "Region Wise" %}</label>
             <div class="checkbox">
              <label><input type="checkbox" value="{Rsegdone}" id ="Rsegdone" 
                onchange="getBoundaryru(this)">
                <span> {% trans "Segregation Activity" %}</span></label>
              </div>
            
            
              <div class="checkbox">
              <label><input type="checkbox"  value="{Rsegquality}" id = "Rsegquality" onchange="getBoundaryru(this)"><span> {% trans "Segregation Quality" %}</span></label>
              </div>

              <div class="checkbox">
                <label><input type="checkbox" value="{Rsegcons}" id ="Rsegcons" onchange="getBoundaryru(this)">
                  <span> {% trans "Segregation consistency" %}</span></label>
                </div>
              
              
                <div class="checkbox">
                <label><input type="checkbox"  value="{Rsegfreq}" id = "Rsegfreq" onchange="getBoundaryru(this)"><span> {% trans "Waste pick up frequency" %}</span></label>
                </div>
            </div>
          </div>
            <br>
    <!-- Focus S ward  -->
        <div class="multiselect">
          <div class="selectBox" onclick="showCheckboxes3('geoS')">
            <button type="button" class="btn btn-outline-dark addMore" title = "More interactions are enable here  as a Pilot area"style="width: 90%;font-size:12px; " title="More interactions have been enable here  as a Pilot area"> {% trans "Focus: S Ward" %}</button>
            <div class="overSelect"></div>
          </div>
        
          <div id="checkboxes11">
            <div class="checkbox" id="boundary">
              <label><input type="checkbox" value="{wardS}" id ="wardS" onchange="getBoundaryru(this)"><span> {% trans "S Ward Boundary" %}</span></label>
              <!-- <div>
                <div id="kwestbuilding">
                  <div class="checkbox" style = "margin: 0 0 0 17px;">
                    <label><input type="checkbox" value="{copS}" id="copS" onchange="getBoundaryru(this)"><span> {% trans "Prabhag Boundaries" %}</span></label>
                  </div>
                  <div class="checkbox" style = "margin: 0 0 0 17px;">
                    <label><input type="checkbox" value="{s-buildings}" id="s-buildings" onclick="getBoundaryru(this)"><span> {% trans "Building Points" %}</span></label>
                  </div>
                </div>-->
            </div>
            
            
              <div class="checkbox">
                <label><input type="checkbox" value="{sbeat}"  id="sbeat"
                    onchange="getBoundaryru(this)" disabled><span> {% trans "S-ward Sweep Beats" %}</span></label>
              </div>
            
            
              <div class="checkbox">
                <label><input type="checkbox" value="{sroads}"  id="sroads"
                    onchange="getBoundaryru(this)"><span> {% trans "S-ward Roads" %}</span></label>
              </div>
              <div class="checkbox">
                <label><input type="checkbox" value="{shbt}"  id="shbt"
                    onchange="getBoundaryru(this)"><span> {% trans "S Wards:HBT Clinics "%}</span></label>
              </div>
            
              <div class="checkbox">
                <label><input type="checkbox" value="{sbuildings}"  id="sbuildings"
                    onchange="getBoundaryru(this)"><span> {% trans "S-ward Buildings" %}</span></label>
              </div>
              <label><b> <font color ='green'>Prabhag 122 Pilot</font></b>  
                <!-- Adding Case studeies for Prabhag 122 -->
                <!-- <div class="selectBox" onclick="showCheckboxes3('geoS')">
                  <button type="button" class="btn btn-outline-dark  btn-sm" title = "C"style="width: 50%;font-size:12px; " title="More ase studies based on several Parameters"> {% trans "Case Studies" %}</button>
                  <div class="overSelect"></div>
                </div>
                 <div id="checkboxes11"> -->
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox"  value="{122bound}" id = "bound122" onchange="getBoundaryru(this)"><span> {% trans "Boundary" %}</span></label>
            </div>
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox"  value="{122regions}" id = "regions122" onchange="getBoundaryru(this)"><span> {% trans "Prabhag 122 regions" %}</span></label>
            </div>
          
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122buildings}"  id="s122buildings"
                  onchange="getBoundaryru(this)"><span> {% trans "Prabhag 122: Buildings" %}</span></label>
            </div>
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122routes}"  id="s122routes"
                  onchange="getBoundaryru(this)"><span> {% trans "Prabhag 122:Waste PickUp Routes "%}</span></label>
            </div>
            
            <!-- <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122buildingslege}"  id="s122buildingslege"
                  onchange="getBoundaryru(this)"><span> {% trans "Prabhag 122: Buildings Legend " %}</span></label>
            </div> -->
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122slums}"  id="s122slums"
                  onchange="getBoundaryru(this)"><span> {% trans "Prabhag 122: Slums" %}</span></label>
            </div>
            
            
            <div class="checkbox" style = "padding-left:2em">
                  <label><input type="checkbox" value="{s122roads}"  id="s122roads"
                      onchange="getBoundaryru(this)"><span> {% trans "Prabhag 122: Roads" %}</span></label>
            </div>
            
            
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{scompost}"  id="scompost"
                  onchange="getBoundaryru(this)"><span> {% trans "Buildings doing composting" %}</span></label>
            </div>
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122plastic}"  id="s122plastic"
                  onchange="getBoundaryru(this)"><span> {% trans "Buildings segregating Plastics "%}</span></label>
            </div>
            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122dumping}"  id="s122dumping"
                  onchange="getBoundaryru(this)"><span> {% trans "Dumping Points "%}</span></label>
            </div>

            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox"  value="{s122gardens}" id = "s122gardens" onchange="getBoundaryru(this)"><span> {% trans "Gardens" %}</span></label>
            </div>

            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122toilet}"  id="s122toilet"
                  onchange="getBoundaryru(this) " disabled><span> {% trans "Public Toilets (in progress)" %}</span></label>
            </div>

            <div class="checkbox" style = "padding-left:2em">
              <label><input type="checkbox" value="{s122car}"  id="s122car"
                  onchange="getBoundaryru(this)" disabled><span> {% trans "Car Parking (in progress)" %}</span></label>
            </div>
            <label><b> <font color ='green'>Prabhag 121</font></b>  
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox"  value="{121bound}" id = "bound121" onchange="getBoundaryru(this)"><span> {% trans "Prabhag Boundary" %}</span></label>
              </div>
              <div class="checkbox" style = "padding-left:4em">
                <label><input type="checkbox"  value="{iitb121bound}" id = "iitbbound121" onchange="getBoundaryru(this)"><span> {% trans "IIT-B Boundary" %}</span></label>
              </div>
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox" value="{s121buildings}"  id="s121buildings"
                    onchange="getBoundaryru(this)"><span> {% trans "Prabhag Buildings" %}</span></label>
              </div>
              <div class="checkbox" style = "padding-left:4em">
                <label><input type="checkbox" value="{s121iitbbuildings}"  id="s121iitbbuildings"
                    onchange="getBoundaryru(this)"><span> {% trans "IIT-B Buildings" %}</span></label>
              </div>
              <div class="checkbox" style = "padding-left:2em">
                <label><input type="checkbox" value="{s121roads}"  id="s121roads"
                    onchange="getBoundaryru(this)"><span> {% trans "Roads" %}</span></label>
              </div>
          </div>
        </div>
        </div>
         <br> 
  
         
<!-- Focus Kwest  -->
	  {% if request.user.is_authenticated %}
          <div class="multiselect">
            <div class="selectBox" onclick="showCheckboxes3('geo')">
              <button type="button" class="btn btn-outline-dark addMore" title = "More interactions are enable here  as a Pilot area"style="width: 90%;font-size:12px; " title="More interactions have been enable here  as a Pilot area"> {% trans "Focus: K-West Pilot" %}</button>
              <div class="overSelect"></div>
            </div>
             <div id="checkboxes3">
              <!-- <div class="checkbox" id="boundary">
                <label><input type="checkbox" value="Mumbai Suburban" onchange="getBoundaryru(this)"><span> {% trans  "Mumbai Suburban Boundary" %}</span></label>
              </div> -->
              
              <div class="checkbox" id="boundary">
                <label><input type="checkbox" value="{wardKWest}" onchange="getBoundaryru(this)"><span> {% trans "K-WEST" %}</span></label>
                <div>
                  <div id="kwestbuilding">
                    <div class="checkbox" style = "margin: 0 0 0 17px;">
                      <label><input type="checkbox" value="{cop}" id="cop" onchange="getBoundaryru(this)"><span> {% trans "Prabhag Boundaries" %}</span></label>
                    </div>
                    <div class="checkbox" style = "margin: 0 0 0 17px;">
                      <label><input type="checkbox" value="{kwest-buildings}" id="buildings" onclick="getBoundaryru(this)"><span> {% trans "K-West Building Points" %}</span></label>
                    </div>
                  </div>
              </div>
              <div class="checkbox">
                <label><input type="checkbox"  value="{61bound}" onchange="getBoundaryru(this)"><span> {% trans "Prabhag 61" %}</span></label>
              </div>
              <div id="checkboxes4">
                <div class="checkbox">
                  <label><input type="checkbox" value="{kwestbeat}"  id="kwestbeat"
                      onchange="getBoundaryru(this)"><span> {% trans "K-West Sweep Beats" %}</span></label>
                </div>
              </div>

            </div>
          </div> 
           <br> 
	  {% endif %}
		  
          {% if request.user|has_group:"wardEditor" %}
          <div class="multiselect">
            <div class="selectBox" onclick="showCheckboxes3('ward')">
              <button type="button" class="btn btn-outline-dark" id="ward" style="width: 90%;font-size:12px; "> {% trans " " %}</button>
              <div class="overSelect"></div>
            </div>
            <div id="ward_check">
              <select class="custom-select" name="dist_select" id="prabhaglist">
                    <option selected disabled>Select Prabhag</option>
                    {% for dist_select in prabhag_list %}
                    <option value="{{ dist_select.prabhag_no }}">{{ dist_select.prabhag_no }}
                    </option>
                    {% endfor %}
                </select>
              <div id="ward_checklist">
                <div class="checkbox">
                  <label>Search Building name:<input type="input" id="search_building"></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" value="{regions}" disabled id="regions" onchange="getBoundaryru(this)"><span> {% trans "Regions" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" value="{buildings}" disabled id="buildings"
                      onchange="getBoundaryru(this)"><span> {% trans "Buildings Clusters" %}</span></label>
                </div>
           
                <div class="checkbox">
                  <label><b><input type="checkbox" value="{buildings}" id="{buildings}"
                        onchange="getBoundaryru(this)"><span> {% trans "Building Points:Prabhag Wise" %}</span></b></label>
                </div>
                {% if request.user.role == "MO" and request.user|has_group:"wardEditor" or request.user|has_group:"prabhagEditor" %}

                <div class="checkbox">
                  <label><b><input type="checkbox" value="{buildings_up}" id="{buildings}"
                        onchange="getBoundaryru(this)"><span> {% trans "Building Points:updated Yesterday" %}</span></b></label>
                </div>
                {% endif %}
             

                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{sra}" id="sra" disabled onchange="getBoundaryru(this)"><span> {% trans "SRA" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{chs}" id="chs" disabled onchange="getBoundaryru(this)"><span> {% trans "CHS" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{smpa}" id="smpa" disabled onchange="getBoundaryru(this)"><span>
                      {% trans "SMPA" %}</span></label>
                </div>

                <div class="checkbox">
                  <label><input type="checkbox" value="{roads}" id="roads"  onchange="getBoundaryru(this)"><span> {% trans "Roads" %}</span></label>
                </div>
              </div> 
              </div>
             
            {% endif %}

          {% if request.user|has_group:"prabhagEditor"  %}
            <div class="multiselect">
              <div class="selectBox" onclick="showCheckboxes3('prabhag')">
                <button type="button" class="btn btn-outline-dark" id="prabhag" style="width: 90%;font-size:12px; "> {% trans " " %}</button>
                <div class="overSelect"></div>
              </div>
              <div id="checkboxes7">
                <div class="checkbox">
                  <label><input type="checkbox" value="{regions}" id="regions" disabled onchange="getBoundaryru(this)"><span> {% trans "Regions" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" value="{buildings}" disabled id="buildings"
                      onchange="getBoundaryru(this)"><span> {% trans "Buildings Clusters" %}</span></label>
                </div>
           
                <div class="checkbox">
                  <label><b><input type="checkbox" value="{buildings}" id="{buildings}"
                        onchange="getBoundaryru(this)"><span> {% trans "Building points :Prabhag Wise" %}</span></b></label>
                </div>
             
              
              

                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{sra}" id="sra" disabled onchange="getBoundaryru(this)"><span> {% trans "SRA" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{chs}" id="chs" disabled onchange="getBoundaryru(this)"><span> {% trans "CHS" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" style = "margin: 0 0 0 17px;"value="{smpa}" id="smpa" disabled onchange="getBoundaryru(this)"><span>
                      {% trans "SMPA" %}</span></label>
                </div>

                <div class="checkbox">
                  <label><input type="checkbox" value="{roads}" id="roads" onchange="getBoundaryru(this)"><span> {% trans "Roads" %}</span></label>
                </div>
                
                <!--Restricted access  -->
                <!-- {% if request.user|has_group:"Editor" %}
                <div class="checkbox">
                  <label><input type="checkbox" value="{buildings_noname}" id="buildings_noname"
                      onchange="getBoundaryru(this)"><span> {% trans "UnNamed Buildings" %}</span></label>
                </div>
                <div class="checkbox">
                  <label><input type="checkbox" value="{regions_noname}" id="regions_noname"
                      onchange="getBoundaryru(this)"><span> {% trans "Unamed Regions in Buildings" %}</span></label>
                </div>-->
                {% endif %} 
                <!-- <div class="checkbox">
                            <label><input type="checkbox" value="{roads}" id ="buildingsosm" onchange="displayPoint()"><span> {% trans "OSM BUILDINGS" %}</span></label>
                          </div>                      

              </div>
              <br>
              {% endif %}
	          
            
              <div class="multiselect">
                <div class="selectBox" onclick="showCheckboxes3('bwg')">
                  <button type="button" class="btn btn-outline-dark" style="width: 90%;font-size:12px; "> {% trans "Bulk Waste Generators" %}</button>
                  <div class="overSelect"></div>
                </div>
                <div id="checkboxes8">
                  <div class="checkbox">
                    <label><input type="checkbox" value="{bwg_city}" id="bwg_city" onchange="getBoundaryru(this)"><span> {% trans "Mumbai City BWG" %}</span></label>
                  </div>
                  <div class="checkbox">
                    <label><input type="checkbox" value="{bwg_es}" id="bwg_es" onchange="getBoundaryru(this)"><span> {% trans "Mumbai Eastern Suburbs BWG" %}</span></label>
                  </div>
                  <div class="checkbox">
                    <label><input type="checkbox" value="{bwg_ws}" id="bwg_ws" onchange="getBoundaryru(this)"><span> {% trans "Mumbai Western Suburbs BWG" %}</span></label>
                  </div>
                <!-- <button type="button" class="btn btn-primary" id='locate'>{% trans "Your Location" %}</button> --> 
            </div>

          </div>
          
          <!-- slums -->
          <div class="multiselect">
            <div class="selectBox" onclick="showSlumLayers()" >
              <button  type="button" class="btn btn-outline-dark" style="width: 90%;font-size:12px; margin-top: 20px;">Slums</button>
              <div class="overSelect"></div>
            </div>
            <div id="checkboxes9" style="display: none;">
              <div class="checkbox">
                <label for=""><input type="checkbox" style = "margin: 0 0 0 17px;"  onchange="getBoundaryru(this)" value="{slum_boundaries}" name="" id="slum_boundaries">{% trans "Slum Boundaries" %}</label>
              </div>
              <div class="checkbox">
                <label for=""><input type="checkbox" style = "margin: 0 0 0 17px;" onchange="getSlumHouseHolds()" name="" id="">{% trans "Slum Households" %}</label>
              </div>
              <div class="checkbox">
                <label for=""><input type="checkbox" style = "margin: 0 0 0 17px;" onchange="getSlumLanes()" name="" id="">{% trans "Slum Lanes" %}</label>
              </div>
            </div>
          </div>

	  <!-- pipelines -->
          <button type="button" onclick="putPipe()" class="btn btn-outline-dark" style="width: 90%;font-size:12px; margin-top: 20px;">Pipeline</button>


        </form>


      </form>
      {% endblock map_content%}
      {% block extra_map_javascript%}
      <script src="{% static 'tilelayer-leaflet.js' %}"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
      <script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
{% autoescape off %}
<script>
      
  let area = null;
  let building_list;
  var legend;
  let windowWidth = window.screen.width;
  let windowHeight = window.screen.height;
  let expanded = false;
  console.log(expanded)
  let wms_legend,popup_layer,layer1;
  let newLayerList = [];
  var polylayer;
  var polylayer2 =[];
  var kwestlayer = [];
  var areaLayerList=[];
  var markerClusters = L.markerClusterGroup({"chunkedLoading": true});
  let buildings_up = [];
  //let buildings = '{{ geojson|safe }}';
  let ward= '{{ward}}';
  let prabhag = '{{prabhag}}';
  var buildinglayerGroup = L.layerGroup();   
  console.log("prabhag in script is",prabhag)
  legend = L.control({position: 'bottomright'});
  $('#prabhag').html('Prabhag '+prabhag +' landmarks')
  $('#ward').html('Ward '+ward +' landmarks')
        

  
        // Define the geodesicArea function
        L.GeometryUtil = L.GeometryUtil || {};
        L.GeometryUtil.geodesicArea = function (latLngs) {
            var area = 0.0;
            if (latLngs.length > 2) {
                for (var i = 0; i < latLngs.length; i++) {
                    var p1 = latLngs[i],
                        p2 = latLngs[(i + 1) % latLngs.length];
                    area += ((p2.lng - p1.lng) * Math.PI / 180) *
                            (2 + Math.sin(p1.lat * Math.PI / 180) +
                            Math.sin(p2.lat * Math.PI / 180));
                }
                area = area * 6378137.0 * 6378137.0 / 2.0;
            }
            return Math.abs(area);
        };

     // define wms_layer1
              
  function showCheckboxes3(th) {
    let checkboxes;
    if (th == 'geo') {
      checkboxes = document.getElementById("checkboxes3");

    }
    if (th == 'geoCS') {
      // alert(th)
      checkboxes = document.getElementById("checkboxes12");
      
      
    }
    if (th == 'geoL') {
      // alert(th)
      checkboxes = document.getElementById("checkboxes13");
      
      
    }
    if (th == 'geoN') {
      checkboxes = document.getElementById("checkboxes10");
      

    }
    if (th == 'geoS') {
      // alert(th)
      checkboxes = document.getElementById("checkboxes11");
      // alert(checkboxes.style.display);

    }
    else if (th == 'prabhag') {
      checkboxes = document.getElementById("checkboxes7");

    }
    else if (th == 'bwg') {
      checkboxes = document.getElementById("checkboxes8");

    }
    else if (th == 'mumbai') {
      checkboxes = document.getElementById("mumbai_whole");

    }
    else if (th == 'ward') {
      checkboxes = document.getElementById("ward_check");

    }
    if (!expanded) {
      
      checkboxes.style.display = "block";
      expanded = true;
    } else {
      checkboxes.style.display = "none";
      expanded = false;
    }
  }
  // var prabhag_sel from select prabhag;
  $("#prabhaglist").change(function() {
    mymap.removeControl(legend);

    var $endpoint = window.location.href // or localhost/interface
    prabhag = $(this).val();
    // alert("prabhag is"+prabhag)
  

    if(polylayer != undefined){
      console.log(polylayer,"poly")
      removeWMS('geonode:mumbai_roads_prabhag_wise_29jan');
      removepolylayer(polylayer);
      document.getElementById("{buildings}").checked = false;
      // console.log(document.getElementById("{roads}").checked)
      document.getElementById("roads").checked = false;
      }
    
    $name1= {'name1': prabhag}
    console.log("name1 is ",$name1)
    $.ajax({
    method: "GET",
    url: $endpoint,
    data: $name1,
    success:function(data) {
      
      building_list = data.building_list;
      // alert("building_list is ",building_list)
      if(data.length > 2){
        buildings = JSON.parse(data.geojson);
        buildings_up = JSON.parse(data.geojson1)
        }
      else{
        buildings = JSON.parse(data.geojson);
        buildings_up = [];
        }
        // prabhag= data.prabhag;
        // var checkboxes = document.getElementById("ward_checklist");

      ward_checklist.style.display = "block";
      expanded = true;
        displaypolygon('{buildings}');
        }
      });
    var sac_no = document.getElementById('search_building');
    console.log("building name is ",sac_no)
    sac_no.setAttribute("list", "browsers2");

    var data_sac_list = document.createElement("DATALIST");
    data_sac_list.setAttribute("id", "browsers2");
    document.getElementById("search_building").appendChild(data_sac_list);
    $.each(building_list, function(key, value) {   
      // console.log(key,value)
      var opt_sac = document.createElement("OPTION");
      opt_sac.setAttribute("value", value.building_name);
      document.getElementById("browsers2").appendChild(opt_sac);
        
      });
  })

	      
// slums
var shck4 = false;
    function showSlumLayers(){
      if(!shck4){
        document.getElementById('checkboxes9').style.display = "block";
        shck4 = true;
      }
      else{
        document.getElementById('checkboxes9').style.display = 'none';
        shck4=false;
      }
    }

var showSlum = false;
var slumLayer;
  function getSlumBoundary(){
    if(!showSlum){
      console.log("show slum = tru")
      mymap.setView([19.12560565499321,72.84072875976564], 15.5)
      slumLayer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/geonode/wms',{
        layers:'geonode:mumbai_slums_9mar23',
        format: 'image/png',
        transparent: 'true',
        styles:'mumbai_slums_9mar23',
        })

        
        slumLayer.addTo(mymap)
        sld='mumbai_slums_9mar23'
        layer = slumLayer.options.layers;
        addWMSLegendfromgeo(layer,sld)        
        showSlum = true
        // alert("slum boundaries")
        // layer1="mumbai_slums_9mar23"
        popup_layer = "https://geonode.communitygis.in/geoserver/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&LAYERS=" + layer + "&QUERY_LAYERS=" + layer;
        console.log("slum popup layer"+popup_layer)
      }
    else{
      mymap.setView([19.359, 72.8304], 12);
      layer = slumLayer.options.layers;
      
      mymap.removeLayer(layer)
      showSlum = false
      }
     
    }

var showSlumHH = false;
var slumHHLayer;
  function getSlumHouseHolds(){
    if(!showSlumHH){
      mymap.setView([19.1495,72.8346], 17)
      slumHHLayer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/geonode/wms',{
        layers:'geonode:merged_slum_HH_9june_poonam',
        format: 'image/png',
        transparent: 'true',
      })

      slumHHLayer.addTo(mymap)
      showSlumHH = true
    }else{
      // mymap.setView([19.1233, 72.7784], 12);
      mymap.removeLayer(slumHHLayer)
      showSlumHH = false
    }
  }

var showSlumLanes = false;
var slumLanesLayer;
  function getSlumLanes(){
    if(!showSlumLanes){
      mymap.setView([19.1493,72.8343], 17)
      slumLanesLayer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/geonode/wms',{
        layers:'geonode:merged_slum_details_9june_poonam',
        format: 'image/png',
        transparent: 'true',
      })

      slumLanesLayer.addTo(mymap)
      showSlumLanes = true
    }else{
      // mymap.setView([19.1233, 72.7784], 12);
      mymap.removeLayer(slumLanesLayer)
      showSlumLanes = false
    }
  }

//DP
var showDP = false;
var DPLayer;
  function putDP(){
    if(!showDP){

      fetch('https://geonode.communitygis.in/geoserver/geonode/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geonode%3ADP_merged_4mar24&outputFormat=application%2Fjson')
      .then(result=>result.json())
      .then((output)=>{
        DPLayer = L.geoJSON(output,{
          onEachFeature: function(feature, layer){
            layer.bindPopup(`<div style="width:auto;">Development Plan Info<hr><br>DP Code: ${feature.properties.NAME}<br>DP Designation: ${feature.properties.subcategor}<br>Ward Name: ${feature.properties.ward_name}<br>Ward: ${feature.properties.Ward}<br>S_No: ${feature.properties.sno}</div>`)
          },
          
        })
        DPLayer.addTo(mymap)

      })


      showDP = true;
    }else{
      showDP = false;
      mymap.removeLayer(DPLayer);

    }
  }

//Pipeline
var showPipe = false
var Pipelayer;
  function putPipe(){
    if(!showPipe){
      mymap.setView([19.13534920516574,72.81797826290132], 17.5)
      Pipelayer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/geonode/wms',{
        layers:'	geonode:pipeline',
        format:'image/png',
        transparent:'true'
      })
      Pipelayer.addTo(mymap)
      showPipe = true;
    }else{
      mymap.setView([19.1233, 72.7784], 12);
      mymap.removeLayer(Pipelayer)
      showPipe = false
    }
  }
      
      
  function setView1(layerName,val, selectedBoundary) {
      if (area) {
          mymap.removeLayer(area);
        }
      let rootUrl = 'https://geonode.communitygis.in/geoserver/'+layerName.split(":")[0]+'/ows';

      let options = {
          service: 'WFS',
          version: '1.0.0',
          request: 'GetFeature',
          outputFormat: 'application/json',
          typeName: layerName,
          cql_filter: `${val}='${selectedBoundary}'`,
          propertyName: 'the_geom'
        };
      let parameters = L.Util.extend(options);
      layer_url = rootUrl + L.Util.getParamString(parameters)
      fetch(layer_url).then(
          function(response) {
            if (response.status !== 200) {
                console.log('Looks like there was a problem. Status Code: ' +
                    response.status);
                return;
              }
            response.json().then(function(geojsonData) {
              area = L.geoJson(geojsonData.features)
              console.log(area)
              lat = area.getBounds()._northEast.lat
              lng = area.getBounds()._northEast.lng
              mymap.setView([lat, lng], 14)
              });
            }).catch(function(err) {
            console.log('Fetch Error :-S', err);
          });
    }


let wardwms;
let prabhagwms_list;
  $("#wardlistwms").change(function() {
    $("#prabhaglistwms option").each(function() {
      $(this).remove();
      });
	//  var $endpoint = window.location.href // or localhost/interface
    layer = 'geonode:Buildings_mumbai';
    wardwms = $(this).val();
    var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
                  layers: 'geonode:Buildings_mumbai',
                  format: 'image/png',
                  transparent: 'true',
                  cql_filter: `ward_id_2='${wardwms}'`,
                });
    wms_layer.addTo(mymap);
    popup_layer = "https://geonode.communitygis.in/geoserver/"+layer.split(":")[0]+"/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&LAYERS=" + wms_layer.options.layers + "&QUERY_LAYERS=" + wms_layer.options.layers;
    removeWMS('geonode:Buildings_mumbai');

    newLayerList.push(wms_layer);
    setView1('geonode:Buildings_mumbai','ward_id_2', wardwms);
    let $name2= {'name2':wardwms}
    var $endpoint = window.location.href // or localhost/interface
    var popup = new L.Popup({ 
                    maxWidth: 300
                     });
    $.ajax({
        method: "GET",
        url: $endpoint,
        data: $name2,
        success: function(data) {
          for (i = 0; i < data.length; i++) {
            var opt = document.createElement("option");
            document.getElementById("prabhaglistwms").innerHTML += '<option id="' + data[i].prabhag_no + '">' + data[i].prabhag_no+ '</option>';
              }
            }
      })
                // mymap.setView([19.1186, 72.8064], 13);
    })


  $("#prabhaglistwms").change(function() {
	//  var $endpoint = window.location.href // or localhost/interface
    var selectedValue = $(this).val();
    var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
                layers: 'geonode:Buildings_mumbai',
                format: 'image/png',
                transparent: 'true',
                cql_filter: `prabhag_no='${selectedValue}'`,

              });
    wms_layer.addTo(mymap);
    removeWMS('geonode:Buildings_mumbai');
    newLayerList.push(wms_layer);

    setView1('geonode:Buildings_mumbai','prabhag_no', selectedValue);
  })
        
  function getBoundaryru(obj) {
    let boundary = obj.value;
    console.log("boundary is :"+boundary);
    if ($(obj).is(":checked")) {

      if (boundary == "Mumbai Suburban") {
        var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
          layers: 'geonode:maha_taluka_13march2021',
          format: 'image/png',
          transparent: 'true',
          cql_filter: `distname='${boundary}'`,

          });
        wms_layer.addTo(mymap);
        newLayerList.push(wms_layer);

        mymap.setView([19.1186, 72.8064], 11);
        }
      else if (boundary == '{slum_boundaries}'){
        putfrmgeo(slum_boundaries);
        }
      else if (boundary == '{kwestbeat}'){
        putfrmgeo(kwestbeat);
        }
      else if (boundary == '{bwg_city}'){
        putfrmgeo(bwg_city);
        }
      else if (boundary == '{bwg_ws}'){
        putfrmgeo(bwg_ws);
       }
      else if (boundary == '{bwg_es}'){
        putfrmgeo(bwg_es);
        }
      else if (boundary == '{mumbai_roads}') {
        putfrmgeo(mumbai_roads);
        }
      else if (boundary == "{wardKWest}") {
        putWMSru("geonode:k_west_mumbai");
        var checkboxes = document.getElementById("kwestbuilding");
        kwestbuilding.style.display = "block";
        expanded = true;
      }
      else if (boundary == "{wardS}") {
        putfrmgeo(wardS);
        // var checkboxes = document.getElementById("kwestbuilding");

        // kwestbuilding.style.display = "block";
        // expanded = true;

      }
      else if (boundary == '{wardL}'){
        putfrmgeo(wardL);
       }
      else if (boundary == '{wardN}'){
        putfrmgeo(wardN);
       }
      else if (boundary == '{Nwardprabhags}'){
        putfrmgeo(Nwardprabhags);
       }
      else if (boundary == '{Lwardprabhags}'){
        putfrmgeo(Lwardprabhags);
       }
      else if (boundary == '{Nroads}') {
        putfrmgeo(Nroads);
      }
      else if (boundary == '{Lroads}') {
        putfrmgeo(Lroads);
      }
      else if (boundary == '{lbuildings}') {
        putfrmgeo(lbuildings);
      }
      else if (boundary == "{156bound}") {  
        
        putfrmgeo(bound156);
      }
      else if (boundary == '{l156buildings}') {
        putfrmgeo(l156buildings);
      }
      else if (boundary == "{157bound}") {  
        
        putfrmgeo(bound157);
      }
      else if (boundary == '{l157buildings}') {
        putfrmgeo(l157buildings);
      }
      else if (boundary == '{Nmor_routes}') {
        putfrmgeo(Nmor_routes);
      }
      else if (boundary == '{Nveg_routes}') {
        putfrmgeo(Nveg_routes);
      }
      else if (boundary == '{Ndebris_routes}') {
        putfrmgeo(Ndebris_routes);
      }
      else if (boundary == '{Nhotel_routes}') {
        putfrmgeo(Nhotel_routes);
      }
      else if (boundary == '{nbuildings}') {
        putfrmgeo(nbuildings);
      }
      else if (boundary == '{n132composting}') {
        putfrmgeo(n132composting);
      }
      else if (boundary == '{n132seg}'){
        putfrmgeo(n132seg);
      }
      else if (boundary == '{n132gardens}'){
        putfrmgeo(n132gardens);
      }
      else if(boundary == '{n132segqual}')  {
        putfrmgeo(n132segqual);
      }
      else if(boundary == '{n132segfreq}')  {
        putfrmgeo(n132segfreq);
      }
      else if (boundary == '{n132staticcount}') {
        // putfrmgeo(n132staticcount);
        console.log("In static 132")
        displaypolygon('132')
      }
      else if (boundary == '{n122staticcount}') {
        // putfrmgeo(n132staticcount);
        console.log("In static 122")
        displaypolygon('122')
      }
      else if (boundary == "{iitb121bound}") {  
        
        putfrmgeo(iitbbound121);
      }
      else if (boundary == '{s121iitbbuildings}') {
        putfrmgeo(s121iitbbuildings);
      }
      else if (boundary == "{121bound}") {  
        
        putfrmgeo(bound121);
      }
      else if (boundary == "{122bound}") {  
        
        putfrmgeo(bound122);
      }
      else if (boundary == '{s121buildings}') {
        putfrmgeo(s121buildings);
      }
      else if (boundary == "{s121roads}") {  
      //  alert(boundary);
        putfrmgeo(s121roads);
      }

      else if (boundary == "{122regions}") {  
      //  alert(boundary);
        putfrmgeo(regions122);
      }
      else if (boundary == '{sroads}') {
        putfrmgeo(sroads);
      }
      else if (boundary == '{sbuildings}') {
        putfrmgeo(sbuildings);
      }
      else if (boundary == '{s122buildings}') {
        putfrmgeo(s122buildings);
      }
      else if (boundary == '{s122routes}') {
        putfrmgeo(s122routes);
      }
      else if (boundary == '{s122buildingslege}') {
        displaypolygon(s122buildingslege);
        // putfrmgeo(s122buildings-lege);
      }
      else if (boundary == "{s122roads}") {  
      //  alert(boundary);
        putfrmgeo(s122roads);
      }
      else if (boundary == "{s122gardens}") {  
      //  alert(boundary);
        putfrmgeo(s122gardens);
      }
      else if (boundary == "{s122slums}") {  
      //  alert(boundary);
        putfrmgeo(s122slums);
      }
      else if (boundary == "{shbt}") {  
      //  alert(boundary);
        putfrmgeo(shbt);
      }
      else if (boundary == '{scompost}') {
        putfrmgeo(scompost);
      }
      else if (boundary == '{s122plastic}'){
        // alert("reached plastic")
        putfrmgeo(s122plastic)
      }
      else if (boundary == '{s122dumping}'){
        // alert("reached plastic")
        putfrmgeo(s122dumping)
      }
      else if ((boundary == '{segdone}')){
        // alert("reached plastic")
        putfrmgeo(segdone)
        
      }
      
      else if (boundary == '{segquality}') {
        // alert("reached plastic")
        putfrmgeo(segquality)
      }
      else if (boundary == '{segfreq}'){
        // alert("reached plastic")
        putfrmgeo(segfreq)
      }
      else if (boundary == '{segcons}'){
        // alert("reached plastic")
        putfrmgeo(segcons)
      }
      else if (boundary == '{description}'){
        // alert("reached plastic")
        putfrmgeo(description)
      }
      else if ((boundary == '{Rsegdone}')){
        // alert("reached plastic")
        putfrmgeo(Rsegdone)
        
      }
      else if (boundary == '{Rsegquality}') {
        // alert("reached plastic")
        putfrmgeo(Rsegquality)
      }
      else if (boundary == '{Rsegfreq}'){
        // alert("reached region frequ")
        putfrmgeo(Rsegfreq)
      }
      else if (boundary == '{Rsegcons}'){
        // alert("reached plastic")
        putfrmgeo(Rsegcons)
      }
      
      else if (boundary == "{wardN}") {
        
        
        putfrmgeo(wardN);
        // var checkboxes = document.getElementById("kwestbuilding");

        // kwestbuilding.style.display = "block";
        // expanded = true;

      }
      else if (boundary == "{132bound}") {  
        
        putfrmgeo(bound132);
      }
      else if (boundary == '{nroads}') {
        putfrmgeo(nroads);
      }
      else if (boundary == '{nbuildings}') {
        putfrmgeo(nbuildings);
      }

      else if (boundary == "{61bound}" )
        putWMSru("geonode:ward61_boundary_1nov21");
      else if (boundary == "{regions}")
        putWMSru("geonode:regions_6dec21");

      else if (boundary == "{buildings}"){
          {% if request.user|has_group:"wardEditor"  %}
              displaypolygon(boundary);
        // console.log("prabhag is ",`${prabhag}`)
        
          {% elif request.user|has_group:"prabhagEditor"  %}
            alert("in display polygon"+`${prabhag}`)

          //     // putfrmgeo(`${prabhag}`)
              displaypolygon(`${prabhag}`);
              {% endif %}
      }
      else if (boundary == "{buildings_up}")
        displaypolygon(boundary);
      else if (boundary == "{buildings_only}")
        putWMSru("geonode:osm_buildings_29oct21");
      else if (boundary == '{roads}'){
        var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
          layers: 'mumbai_roads_prabhag_wise_29jan',
          format: 'image/png',
          transparent: 'true',
          cql_filter: `prabhag_no='${prabhag}'`,
          styles:'mumbai_roads_prabhagwise20oct23',
          });
        wms_layer.addTo(mymap);
        newLayerList.push(wms_layer);
        addWMSLegendfromgeo('mumbai_roads_prabhag_wise_29jan','mumbai_roads_prabhagwise20oct23');
        setView1('geonode:Buildings_mumbai','prabhag_no', prabhag);
         }
      else if(boundary == '{cop}')
        putWMSru("kwest_corporator_ward_31st_dec");
      else if (boundary == "{buildings_noname}")
        displaypolygon(boundary);
      else if (boundary == "{regions_noname}")
        displaypolygon(boundary);
      else if (boundary == "{kwest-buildings}")
        {  putWMSru("geonode:k-west_building");}
        else if (boundary == "{mumbai_ward}")
          putWMSru("geonode:mumbai_ward_boundary_2Jan2022");
        else if (boundary == "{mumbai_prabhag}")
          putWMSru("geonode:Mumbai_Prabhag_Boundaries_3Jan2022V2");
        else if (boundary == "{mumbai_buildings}")
          putWMSru("geonode:Buildings_mumbai");
        else if (boundary == "{DP}"){
          console.log("DP called in putru")
          putfrmgeo(DP);}
        // putWMSru("Buildings_mumbai:mumbai_city_3july2021");
        else if (boundary == "{mumbai_waterbodies}"){
          console.log("DP called in putru")
          putfrmgeo(mumbai_waterbodies);}

      } 
      else {
        if (boundary == "{wardKWest}") {
          removeWMS("geonode:k_west_mumbai")
          removeWMS("geonode:k-west_building")
          removeWMS("kwest_corporator_ward_31st_dec");
          kwestbuilding.style.display = "none";
          expanded = false;
          }
        else if(boundary =="{kwestbeat}")
            removeWMS("geonode:k_west_beat_22jan")
        else if (boundary == "{mumbai_waterbodies}"){
          console.log("remove water bodies")
            removeWMS("geonode:mumbai_waterbodies_6mar23")}
        else if (boundary == "{bwg_city}")
          removeWMS("geonode:BWG_City_29Jan");
        else if (boundary == "{bwg_ws}")
          removeWMS("geonode:BWG_WS_27Jan2022");
        else if (boundary == "{bwg_es}")
          removeWMS("BWG_ES_29Jan");
        else if (boundary == "Mumbai Suburban")
          removeWMS("geonode:maha_taluka_13march2021");
        else if (boundary == "{kwest-buildings}")
          removeWMS("geonode:k-west_building");
        else if (boundary == "{regions}")
          removeWMS("geonode:regions_6dec21");
        else if (boundary == "{61bound}")
          removeWMS("geonode:ward61_boundary_1nov21");
        else if (boundary == "{cop}")
          removeWMS("kwest_corporator_ward_31st_dec");
        else if (boundary == "{mumbai_ward}")
          removeWMS("geonode:mumbai_ward_boundary_2Jan2022");
        else if (boundary == "{mumbai_prabhag}")
          removeWMS("geonode:Mumbai_Prabhag_Boundaries_3Jan2022V2");
        else if (boundary == "{mumbai_buildings}")
          removeWMS("geonode:Buildings_mumbai");

        else if (boundary == "{DP}")
            removeWMS("DP_merged_4mar24");
        else if (boundary == "{mumbai_roads}")
            removeWMS("mumbai_roads_prabhag_wise_29jan");
        
        else if (boundary == "{wardN}")
            removeWMS("mumbai_ward_boundary_2Jan2022");
        else if (boundary == "{wardL}")
            removeWMS("mumbai_ward_boundary_2Jan2022");
        else if (boundary == "{Lwardprabhags}")
            removeWMS("Mumbai_Prabhag_Boundaries_3Jan2022V2");
          
        else if (boundary == '{Lroads}') {
          removeWMS("mumbai_roads_prabhag_wise_29jan");
          }
        else if (boundary == "{156bound}")
            removeWMS("Mumbai_Prabhag_Boundaries_3Jan2022V2");
        else if (boundary == "{157bound}")
            removeWMS("Mumbai_Prabhag_Boundaries_3Jan2022V2");
        else if (boundary == "{l156buildings}")
            removeWMS("Buildings_mumbai");
        else if (boundary == "{l157buildings}")
            removeWMS("Buildings_mumbai");
        else if (boundary == "{122bound}")
            removeWMS("S_ward");
        else if (boundary == "{Nwardprabhags}")
            removeWMS("Mumbai_Prabhag_Boundaries_3Jan2022V2");
          // removeWMS('prabhags_2023_v3');
        else if (boundary == '{Nroads}') {
          removeWMS("Nward_roads_11feb23");
          }
          else if (boundary == '{Nmor_routes}') {
          removeWMS("Nward_morningRoutes_8feb23");
          }
        else if (boundary == '{Nveg_routes}') {
          console.log("remove veg route")
          removeWMS("route");
          }
        else if (boundary == '{Ndebris_routes}') {
          removeWMS("Debris_route16jan24");
          }
        else if (boundary == '{Nhotel_routes}') {
          removeWMS("Updated_hotel_route");
          }
        else if (boundary == '{s121roads}') {
          removeWMS("mumbai_roads_prabhag_wise_29jan");
          }
        else if (boundary == "{iitb121bound}")
          removeWMS("IITB_BOUNDARY");
        else if (boundary == "{s121iitbbuildings}")
            removeWMS("geonode:buildings_2oct21");
        else if (boundary == "{121bound}")
            removeWMS("S_ward");
        else if (boundary == "{122bound}")
            removeWMS("S_ward");
        else if(boundary =="{122regions}")
            removeWMS("regions_prabhag122")
        else if (boundary == "{wardS}")
            removeWMS("S_ward");
        else if (boundary == '{sroads}') {
          removeWMS("S_wardRoads");
        }
        else if (boundary == '{segdone}' || boundary =='{segquality}' ||boundary =='{segfreq}' ||boundary =='{segcons}' ||boundary =='{description}') {
          removeWMS("P122_builiings_updatedSegreagation_columns_22");
        }
        else if (boundary == '{Rsegdone}' || boundary =='{Rsegquality}' ||boundary =='{Rsegfreq}' ||boundary =='{Rsegcons}') {
          removeWMS("updated_regions_p122_28oct23");
        }
        else if (boundary == '{sbuildings}' || boundary =='{nbuildings}' ||boundary =='{s122buildings}' ||boundary =='{s121buildings}') {
          removeWMS("Buildings_mumbai");
        }
        else if (boundary == '{scompost}') {
          removeWMS("compost_facility_24feb23");
        }
        else if (boundary == '{s122plastic}') {
          removeWMS("ward_122_building_collecting_plastic_13oct21");
        }
        else if (boundary == '{s122dumping}') {
          removeWMS("p122_dumpingpoint");
        }
        else if (boundary == '{s122routes}') {
          removeWMS("p122_garbages_routes_20april23");
        }
        else if (boundary == '{s122roads}') {
          removeWMS("mumbai_roads_prabhag_wise_29jan");
        }
        else if (boundary == '{s122gardens}') {
          removeWMS("P122_Gardens_19april2023");
        }
        else if (boundary == '{s122slums}') {
          removeWMS("Asha_yearners_14apr23_merged");
        }
        else if (boundary == '{shbt}') {
          removeWMS("suraj");
        }
        else if (boundary == "{132bound}")
            removeWMS("N_ward");
        else if (boundary == "{wardN}")
            removeWMS("N_ward");
        else if (boundary == '{nroads}') {
          removeWMS("N_wardRoads");
        }
        else if(boundary == "{n132composting}"){
          removeWMS("compost_facility_P132_6feb23")
        }
        else if((boundary == '{n132seg}')||(boundary == '{n132segqual}') ||(boundary == '{n132segfreq}' )) {
          removeWMS("Merged_11jan24")
        }
        else if(boundary == "{n132gardens}"){
          removeWMS("P132_updated_gardens_16jan24")
        }
        else if (boundary == '{nbuildings}') {
          removeWMS("Buildings_mumbai");
        }
        else if (boundary == '{slum_boundaries}'){
        // alert('in remove layer')
          removeWMS("mumbai_slums_9mar23");
        }
        // else if ((boundary == "{buildings}") || (boundary == "{n132staticcount}")) {
        else if ((boundary == "{buildings}") || (boundary == "{n132staticcount}") || (boundary == "{n122staticcount}")) {

          mymap.removeControl(legend);

          removepolylayer(polylayer);

        }
        else if (boundary == "{buildings_up}") {
          mymap.removeControl(legend);
          removepolylayer(polylayer);
          }
        else if (boundary == "{roads}")
          removeWMS('mumbai_roads_prabhag_wise_29jan');
        else if (boundary == "{buildings_noname}")
          removepolylayer(polylayer);
        else if (boundary == "{regions_noname}")
          removepolylayer(polylayer);
        
        };
  }
  function removeWMS(unchecked_layer) {
    newLayerList.forEach((layer, index) => {
      if (layer.options.layers === unchecked_layer) {
       mymap.removeLayer(layer);
        newLayerList.splice(index, 1);
        if (wms_legend) {
          mymap.removeControl(wms_legend);
          }
        addWMSLegend(layer);
        }
      });
    
    }

  function removepolylayer(layer){
    console.log("Polylayer for removepolylayer is ",layer)
      mymap.removeLayer(layer);
      // mymap.removeControl(wms_legend);
      // mymap.clearLayers();
    }
  function putfrmgeo(layers) {
    // alert("in putfrmgeo");
    // alert(layers.value)
    // alert(layers);
    layer1 = layers;
    var obj = layers.value;
    console.log("put frm geo layers value "+obj);
    console.log("put frm geo layers "+layer1);
    var sld = '';
    // if (layer1 == "132") {
    if(obj == null && layers != null) {
      console.log("buildings is displayed for prabhag you have rights",layers)
      layer1 =layers
      layer = 'Buildings_mumbai';
      currentPos = [19.0765, 72.8987];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no=`+layers;
      style=""

      // console.log("cql is",cql)
    }
    if(obj == "{n132composting}") {
      // console.log("buildings composting in 132",layers)
      // layer1 =layers
      layer = 'compost_facility_P132_6feb23';
      currentPos = [19.0765, 72.8987];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `INCLUDE`;
      style="compost_facility_24feb23"

      // console.log("cql is",cql)
    }
    if(obj == "{n132seg}")  {
      console.log("buildings doing seg in 132",layers,obj)
      // layer1 =layers
      layer = 'Merged_11jan24';
      currentPos = [19.0765, 72.8987];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `INCLUDE`;
      sld="seg_done";
        // if(obj == "{n132seg}"){
          
          
        //   //  alert("style os :",sld)
        //   console.log("in seg dne")
        // }
        // if(obj == "{n132segqual}"){
        //   console.log("in seg qual")
        //   sld="seg_quality_v1";

        // }
        // if(obj == "{n132segfreq}"){
        //   console.log("in seg feq")

        //   sld="frequency_v1";
        // }


      // console.log("cql is",cql)
    }
    if(obj == "{n132segqual}")  {
      // alert("seg quali ",obj)
      console.log("buildings doing seg in 132",layers,obj)
      // layer1 =layers
      layer = 'Merged_11jan24';
      currentPos = [19.0765, 72.8987];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `INCLUDE`;
      sld="seg_quality_v1";
    }
    if(obj == "{n132gardens}")  {
      // alert("seg quali ",obj)
      console.log("gardens  132",layers,obj)
      // layer1 =layers
      layer = 'P132_updated_gardens_16jan24';
      currentPos = [19.0765, 72.8987];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `INCLUDE`;
      sld="";
    }
    if(obj == "{n132segfreq}")  {
      // alert("seg quali ",obj)
      console.log("buildings doing seg in 132",layers,obj)
      // layer1 =layers
      layer = 'Merged_11jan24';
      currentPos = [19.0765, 72.8987];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `INCLUDE`;
      sld="";
    }
    if (obj == "{kwestbeat}") {
      
      layer = 'geonode:k_west_beat_22jan';
      var currentPos = [19.1211, 72.8155];
      var maximumzoom = 19;
      // var opac = 0.6;
      var zoom = 13;
      var cql =`INCLUDE`
    }
  //   if (obj == "{roads}") {
      
  //    layer = 'mumbai_roads_prabhag_wise_29jan';
  //    var currentPos = [19.1211, 72.8155];
  //    var maximumzoom = 19;
  //    // var opac = 0.6;
  //    var zoom = 13;
  //    var cql =`prabhag_no='${prabhag}'`,
  //    sld ='mumbai_roads_prabhagwise20oct23',
  //  }
  else if (obj == '{mumbai_waterbodies}'){
      console.log("In water bodies")
      layer = 'geonode:mumbai_waterbodies_6mar23';
      var currentPos = [19.1051, 72.8769];
      var maximumzoom = 19;
      // tranparent = true;
      var opac = 0.1;
      var zoom = 13;
      var cql =`INCLUDE`

    }
    else if (obj == '{bwg_city}'){
      layer = 'geonode:BWG_City_29Jan';
      var currentPos = [18.9944, 72.8043];
      var maximumzoom = 19;
      // tranparent = true;
      // var opac = 0.7;
      var zoom = 12;
      var cql =`INCLUDE`

    }
    else if (obj == '{bwg_ws}'){
      layer = 'geonode:BWG_WS_27Jan2022';
      var currentPos = [19.1337, 72.7954];
      var maximumzoom = 19;
      // var opac = 0.3;
      var zoom = 13;
      var cql =`INCLUDE`
    }
    else if (obj == '{bwg_es}'){
      layer = 'BWG_ES_29Jan';
      var currentPos = [19.1022, 72.8752];
      var maximumzoom = 19;
      // var opac = 1.0;
      var zoom = 13;
      var cql =`INCLUDE`
    }

    else if (obj == '{DP}'){
     
      console.log("In DP ")
     
      layer ='DP_merged_4mar24';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 12;
      var cql =`INCLUDE`
    }
    else if (obj == '{wardS}'){
      
      layer = 'S_ward';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.134, 72.923];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`INCLUDE`

    }
    else if (obj == '{shbt}'){
      // alert("hbt")
      layer = 'suraj';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.134, 72.923];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`INCLUDE`

    }
    else if (obj == '{wardL}'){
      // alert("I am in L ward")
      layer = 'mumbai_ward_boundary_2Jan2022';
      // var currentPos = [19., 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.098, 72.886];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`ward_name_='L'`

    }
    else if (obj == '{Lwardprabhags}'){
      // alert("I am in N ward")
      layer = 'Mumbai_Prabhag_Boundaries_3Jan2022V2';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.098, 72.886];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`Ward_Name='L'`  
      
    }
    else if (obj == '{Lroads}'){
      // alert("I am in N ward")
      layer = 'mumbai_roads_prabhag_wise_29jan';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.084, 72.927];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`ward_id='L'`  
      
    }
    else if (obj == '{156bound}'){       
      layer = 'Mumbai_Prabhag_Boundaries_3Jan2022V2';
      currentPos = [19.1236, 72.891];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `prabhag_no='156'`  

    }
    else if (obj == '{157bound}'){       
      layer = 'Mumbai_Prabhag_Boundaries_3Jan2022V2';
      currentPos = [19.1236, 72.891];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `prabhag_no='157'`  

    }
    else if (obj == '{l156buildings}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.1236, 72.891];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no='156'`

    }
    else if (obj == '{l157buildings}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.1236, 72.891];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no='157'`

    }
    else if (obj == '{wardN}'){
      // alert("I am in N ward")
      layer = 'mumbai_ward_boundary_2Jan2022';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.084, 72.927];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`ward_name_='N'`

    }
    
    else if (obj == '{Nwardprabhags}'){
      // alert("I am in N ward prabhags")
      layer = 'Mumbai_Prabhag_Boundaries_3Jan2022V2';
      currentPos = [19.084, 72.927];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var ward_name = "Ward_Name='N'";
      var cql =ward_name;
      
    }
    
    else if (obj == '{Nroads}'){
      // alert("I am in N ward")
      layer = 'Nward_roads_11feb23';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.084, 72.927];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`INCLUDE`  
      
    }
    
    else if (obj == '{Nmor_routes}'){
      // alert("I am in N ward routes")
      layer = 'Nward_morningRoutes_8feb23';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.081, 72.909];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      // var cql =`ward_id='N'` 
      var cql= `INCLUDE`; 
      // alert(layer)
    }
    else if (obj == '{Nveg_routes}'){
      // alert("I am in N ward routes")
      layer = 'route';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.081, 72.909];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      // var cql =`ward_id='N'` 
      var cql= `INCLUDE`; 
      // alert(layer)
    }
    else if (obj == '{Ndebris_routes}'){
      // alert("I am in N ward routes")
      layer = 'Debris_route16jan24';
      currentPos = [19.081, 72.909];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      // var cql =`ward_id='N'` 
      var cql= `INCLUDE`; 
      // alert(layer)
    }
    else if (obj == '{Nhotel_routes}'){
      // alert("I am in N ward routes")
      layer = 'Updated_hotel_route';
      currentPos = [19.081, 72.909];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      // var cql =`ward_id='N'` 
      var cql= `INCLUDE`; 
      // alert(layer)
    }
    else if (obj == '{nbuildings}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.084, 72.897];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 14;
      var cql = `ward_name_='N'`

    }
    else if (obj == '{iitb121bound}'){       
      layer = 'IITB_BOUNDARY';
      currentPos = [19.134, 72.9025];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `include`  

    }
    else if (obj == '{121bound}'){       
      layer = 'S_ward';
      currentPos = [19.134, 72.923];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `prabhag_no='121'`  

    }
    else if (obj == '{122bound}'){       
      layer = 'S_ward';
      currentPos = [19.134, 72.923];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;   
      var cql = `prabhag_no='122'`  

    }
    else if (obj == '{122regions}'){       
      layer = 'regions_prabhag122';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`  

    }
    else if (obj == '{segdone}'){       
      layer = 'P122_builiings_updatedSegreagation_columns_22';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "seg_done";

    }
    else if (obj == '{segquality}'){       
      layer = 'P122_builiings_updatedSegreagation_columns_22';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "seg_quality_v1";

    }
    else if (obj == '{segcons}'){       
      layer = 'P122_builiings_updatedSegreagation_columns_22';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "consistancy_v1";

    }
    else if (obj == '{segfreq}'){       
      layer = 'P122_builiings_updatedSegreagation_columns_22';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "frequency_v1";

    }
    else if (obj == '{description}'){       
      layer = 'P122_builiings_updatedSegreagation_columns_22';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "description";

    }
    else if (obj =='{Rsegdone}'){
      layer = 'updated_regions_p122_28oct23';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "region_segdone"
      }
    else if (obj =='{Rsegquality}'){
      layer = 'updated_regions_p122_28oct23';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "region_segquality"
    }
    else if (obj =='{Rsegcons}'){
      layer = 'updated_regions_p122_28oct23';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "region_consistency"
      }
    else if(obj =='{Rsegfreq}'){
      layer = 'updated_regions_p122_28oct23';
      // alert(layer)
      currentPos = [19.1196, 72.9043];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;   
      var cql = `INCLUDE`;
      sld = "region_frequency"
    }
    
    else if (obj == '{mumbai_roads}'){
      // alert("in S roads")
      layer = 'mumbai_roads_prabhag_wise_29jan';
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 12;
      var cql = `INCLUDE`

    }

    else if (obj == '{sroads}'){
      // alert("in S roads")
      layer = 'S_wardRoads';
      currentPos = [19.1371, 72.9298];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql= `INCLUDE`;
      // var cql = `ward_id='S'`


    }
    else if (obj == '{sbuildings}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 14;
      var cql = `ward_name_='S'`;
      // sld= "bldgStyle";

    }
    else if (obj == '{s121buildings}'){
      // alert("in S 121 buildings");
      layer = 'Buildings_mumbai';
      currentPos = [19.1296, 72.9001];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no='121'`

    }
    else if (obj == '{s121iitbbuildings}'){
      // alert("in S 121 IITb buildings");
      layer = 'geonode:buildings_2oct21';
      currentPos = [19.1296, 72.9001];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `include`

    }
    else if (obj == '{s121roads}'){
      // alert("in 122 roads")
      layer = 'mumbai_roads_prabhag_wise_29jan';
      currentPos =  [19.1296, 72.9001];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no='121'`

    }
    else if (obj == '{s122buildings}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no='122'`

    }
    else if (obj == '{s122routes}'){
      // alert("in S routes")
      layer = 'p122_garbages_routes_20april23';
      currentPos = [19.12, 72.9081];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 16;
      var cql = `prabhag_no='122'`

    }
    else if (obj == '{s122buildings-lege}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 14;
      var cql = `prabhag_no='122'`
      style=""

    }
    else if (obj == '{scompost}'){
      // alert("in S compost")
      layer = 'compost_facility_24feb23';
      currentPos = [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `include`

    }
    
    else if (obj == '{s122plastic}'){
      // alert("in S plastic ")
      layer = 'ward_122_building_collecting_plastic_13oct21';
      currentPos = [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `include`

    }
    else if (obj == '{s122dumping}'){
      // alert("in S plastic ")
      layer = 'p122_dumpingpoint';
      currentPos = [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `include`

    }
    else if (obj == '{s122roads}'){
      // alert("in 122 roads")
      layer = 'mumbai_roads_prabhag_wise_29jan';
      currentPos =  [19.1283, 72.9041];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 15;
      var cql = `prabhag_no='122'`

    }
    else if (obj == '{s122gardens}'){
      // alert("in 122 roads")
      layer = 'P122_Gardens_19april2023';
      currentPos =  [19.1172, 72.9051];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 16;
      var cql = `include`

    }
    else if (obj == '{s122slums}'){
      // alert("in 122 roads")
      layer = 'Asha_yearners_14apr23_merged';
      currentPos =  [19.1242, 72.9177];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 16;
      var cql = `INCLUDE`

    }

    else if (obj == '{wardN}'){
      
      layer = 'N_ward';
      // var currentPos = [19.1022, 72.8752];
      // var maximumzoom = 19;
      // var opac = 1.0;
      // var zoom = 13;
      currentPos = [19.089, 72.921];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql =`INCLUDE`

    }
    else if (obj == '{132bound}'){       
      layer = 'N_ward';
      currentPos = [19.089, 72.921];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;   
      var cql = `prabhag_no='132'`  

    }

    else if (obj == '{nroads}'){
      // alert("in S roads")
      layer = 'N_wardRoads';
      currentPos = [19.089, 72.921];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 13;
      var cql= `INCLUDE`;
      // var cql = `ward_id='S'`


    }

    else if (obj == '{nbuildings}'){
      // alert("in S roads")
      layer = 'Buildings_mumbai';
      currentPos = [19.089, 72.921];
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 14;
      var cql = `ward_name_='N'`

    }
    else if (obj == '{slum_boundaries}'){
      // alert("in slums")
      layer = 'mumbai_slums_9mar23';
      currentPos = [19.125, 72.840];
      
      var maximumzoom = 20;
      var opac = 0.3;
      var zoom = 14;
      var cql = `INCLUDE`;
      var sld = "mumbai_slums_9mar23"


    }
             
    wms_layer1 = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
      layers: layer,
      format: 'image/png',
      
      // opacity: opac,
      transparent: true,
      currentPos:[19.1233, 72.7784],
      maxZoom: maximumzoom,
      cql_filter:cql,
      // style: subteStyle(feature),
      styles: sld,
      });
    wms_layer1.addTo(mymap);
    mymap.setView(currentPos, zoom,cql);
    newLayerList.push(wms_layer1);
    // alert("cql "+cql);
   
    popup_layer = "https://geonode.communitygis.in/geoserver/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&LAYERS=" + wms_layer1.options.layers + "&QUERY_LAYERS=" + wms_layer1.options.layers;
    if (wms_legend) {
      mymap.removeControl(wms_legend);
      }
    console.log("layer and sld for legend",layer,"-",sld,"-",cql)
    addWMSLegendfromgeo(layer,sld,cql);
                    
  }

       
  function putWMSru(layer) {
    layer1 = layer;
    console.log("Putwmsru- layer is "+layer);
    if (layer == "geonode:k_west_mumbai") {
      layer = 'geonode:k_west_mumbai';
      currentPos = [19.1233, 72.7784];
      var maximumzoom = 19;
      var opac = 0.6;
      var zoom = 13;
      }
    else if (layer == "geonode:regions_6dec21") {
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 0.5;
      var zoom = 16;
    }
    else if (layer == "geonode:ward61_boundary_1nov21") {
      currentPos = [19.1423, 72.8137];
      var maximumzoom = 20;
      var opac = 0.5;
      var zoom = 13;
    }
    else if (layer == "geonode:osm_buildings_29oct21") {
      currentPos = [19.1467, 72.8283];
      layer = "";
      var maximumzoom = 20;
      var opac = 0.1;
      var zoom = 16;

    }
    else if (layer == "geonode:ward61osmroad25OCT") {
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 0.5;
      var zoom = 16;
    }
    else if (layer == "geonode:Mumbai_Prabhag_Boundaries_3Jan2022V2"){
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 0.8;
      var zoom = 12;
    }
    else if (layer == "geonode:mumbai_ward_boundary_2Jan2022"){
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 0.8;
      var zoom = 12;
    }
    else if (layer == "geonode:Buildings_mumbai"){
      // alert("whole buildings")
      layer = "geonode:Buildings_mumbai";
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 1;
      var zoom = 12;
      // var cql=`ward_name_='S'`;
    }
    else{
    // alert("in putwmsru else part")
      currentPos = [19.1467, 72.8283];
      var maximumzoom = 20;
      var opac = 1;
      var zoom = 12;
      // var cql=`INCLUDE`;
    }
    var wms_layer = L.tileLayer.wms('https://geonode.communitygis.in/geoserver/wms', {
      layers: layer,
      format: 'image/png',
      opacity: opac,
      transparent: true,
      maxZoom: maximumzoom,
      // cql_filter:cql,

      });
    wms_layer.addTo(mymap);
    mymap.setView(currentPos, zoom);
    newLayerList.push(wms_layer);
    popup_layer = "https://geonode.communitygis.in/geoserver/"+layer.split(":")[0]+"/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&LAYERS=" + wms_layer.options.layers + "&QUERY_LAYERS=" + wms_layer.options.layers;
    
    console.log("popu up layer is ",layer)
    // const legendContainer = document.createElement('div');
    // legendContainer.id = 'legend-container';
    // mymap.getContainer().appendChild(legendContainer);

    if (wms_legend) {
      mymap.removeControl(wms_legend);
    }

    addWMSLegend(layer);
  }

function bldgStyle(feature){
    // alert("called")
    if(feature.properties.is_bwg=='Yes'){
        alert("In stle")
        return {
        fillColor: 'black',
        weight: 3,
        opacity: 1,
        color: 'white',
        fillOpacity: 0.9
        };
    }
    else{
      // alert("In else stle")
        return {
        fillColor: getColor(feature.properties.is_bwg),
        weight: 3,
        opacity: 1,
        color: 'black',
        fillOpacity: 0.9
        };
    }

  }
//   

  function onEachFeatureForPointBB(feature, layer) {

    let variable = feature.properties.validity;
    // console.log(feature)
    var today = new Date();
    let time = today.toLocaleString();
    let isBwgValue = feature.properties.is_bwg;

    // alert(layer.properties.name+"="+feature);
    // layer.on({click:onClick })
    // if(${feature.properties.name} !== null){
    layer.bindPopup(`<div class = 'text-left'><label>Hello ! {{ request.user.username }}. </lable>
    <form method="POST" class="post-form" action="/buildupdate/${feature.properties.sac_number}" style="margin-top: 20px; width:400px">
    {% csrf_token %}
    
    <table class="table-bordered table-striped">
      <tr><td align ="left"><label class="required">{% trans "SAC Number" %}</label></td>
        <td><input type="text" disabled name="sac" id="id_sac" disabled value="${feature.properties.sac_number}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr><td align ="left"><label class="required">{% trans "Building Name:" %}</label></td><td><input type="text" name="building_name" id="id_building_name" value="${feature.properties.building_name}" /></td></tr>
      <tr><td align ="left"><label class="required">{% trans "Road Name:" %}</label></td><td><input type="text" name="road" id="id_road" value="${feature.properties.road}" /></td></tr>
      <tr><td align ="left"><label>{% trans "Region Name:" %}</label></td><td><input type="text" name="region" id="id_region" value="${feature.properties.region}" /></td></tr>
      
      <tr class="blank_row"></tr><tr><td align ="left"><label>{% trans "Is BWG:" %}</label></td>
      <td style="background-color: white;color:black;">
        <select style = "width: 100%;" name="is_bwg" id="id_is_bwg" value ="${feature.properties.is_bwg}" onchange="updateOptions()"> 
          <option style="width:400px;" value="${feature.properties.is_bwg}" disabled selected>${feature.properties.is_bwg}</option>
          <option style="width:400px;"value="yes"> Yes </option>
          <option style="width:400px;"value="no"> No </option>
          <option style="width:400px;"value="no data"> No data </option>         
        </select></td></tr>
      <tr class="blank_row"></tr><tr><td align ="left"><label>{% trans "BWG type:" %}</label></td><td><input type="text" name="bwg_type" id="id_bwg_type" value="${feature.properties.bwg_type}" /></td></tr>
      <tr class="blank_row"></tr><tr><td align ="left"><label>{% trans "Is Composting:" %}</label></td><td><input type="text" name="is_compost" id="id_is_compost" value="${feature.properties.is_compost}" /></td></tr>
      <tr class="blank_row"></tr><tr><td align ="left"><label>{% trans "Composting Type:" %}</label></td><td><input type="text" name="compost_type" id="id_compost_type" value="${feature.properties.compost_type}" /></td></tr>

      <tr><td align ="left">{% trans "Building Type:" %}</td><td><input type="text" name="building_type" id="id_building_type" value="${feature.properties.building_type}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr><td align ="left">{% trans "Wing Name:" %}</td><td><input type="text" name="wing_name" id="id_wing_name" value="${feature.properties.wing_name}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr class="blank_row"></tr>
      <tr><td align ="left">{% trans "Number of Floors:" %}</td><td><input type="number" name="num_floors" id="id_num_floors"  value="${feature.properties.num_floors}" /></td></tr>
      <tr><td align ="left"><label>{% trans "Number of Flats:" %}</label></td><td><input type="number" name="num_flat" id="id_num_flat"  value="${feature.properties.num_flat}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr><td align ="left">{% trans "Number of Shops:" %}</td><td><input type="number" name="num_shops" id="id_num_shops"  value="${feature.properties.num_shops}" /></td></tr>
      <tr><td align ="left"><label class="required">{% trans "Population:" %}</td><td> <input type="text" name="population" required   id="id_population" value="${feature.properties.population}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr class="blank_row"></tr>    
      
      <tr><td align ="left">{% trans "Village:" %}</td><td><input type="text" name="village" id="id_village" value="${feature.properties.village}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr><td align ="left">{% trans "Remarks:" %}</td><td><input type="text" name="remark" id="id_remark" value="${feature.properties.remark}" /></td></tr>
      <tr class="blank_row"></tr>

      
      <tr><td align ="left">{% trans "Property Address:" %}</td><td><input type="text" name="address" id="id_address" value="${feature.properties.address}" /></td></tr>
      <tr class="blank_row"></tr>    
      {% if request.user.role != "MO" and request.user|has_group:"wardEditor" or request.user|has_group:"prabhagEditor" %}
      <tr><td align ="left">{% trans "Validity:" %}</td><td><input type="text" disabled name="validity" id="id_validity" value="${feature.properties.validity}" /></td></tr>
      <tr class="blank_row"></tr>    
      {% elif request.user.role == "MO" and request.user|has_group:"wardEditor" or request.user|has_group:"prabhagEditor" %}
      <tr><td align ="left">{% trans "Validity:" %}</td><td><input type="text"  name="validity" id="id_validity" value="True" /></td></tr>
      <tr class="blank_row"></tr>  
      {% endif %}
      <tr disaled><td align ="left">{% trans "Updated By(username):" %}</td><td> <input type="text" name="updated_by" required   id="id_updated_by" value="{{ request.user.username }}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr disabled><td align ="left">{% trans "Update Time:" %}</td><td><input type="text" name="update_time" required   id="id_update_time" value="${time}" /></td></tr>
      <tr class="blank_row"></tr>
      <tr><td align ="left">{% trans "Device IP:" %}</td><td><input type="text" name="device_ip" disabled id="id_device_ip" value="" /></td></tr>
      <tr class="blank_row"></tr>
    </table>
  
    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
          <button type="submit" class="btn btn-success">{% trans "Update" %}</button>

      </div>
    </div>
  </form>
  {% if request.user|has_group:"wardEditor" or request.user|has_group:"prabhagEditor" and request.user.role == "MO" %}
    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
      
          <button type="submit"
          {% if '{{ ${variable}|yesno:"yeah" }}' %} 
          class="btn btn-success"
          {% elif '${variable}' is not false %}
          class="btn btn-danger"
        
          {% endif%}
          id="validate" onclick="validate('${feature.properties.sac_number}')">{% trans "Authenticate" %}</button>

      </div>
    </div>
  {% endif %}
  <tr ><td colspan =2 ><a href='/garbage_seg_rev/${feature.properties.sac_number}' class="btn btn-success">Add Waste Segregation Details</a></td></tr></div>`
    //       <table border =2><tr class="bg-primary"><td colspan=2>Building Information</td></tr>
    //       <tr><td><b>SAC No.: </b></td><td> ${feature.properties.sac_number} </td></tr>
    //                         <tr><td><b>Building Name: </b></td><td>${feature.properties.building_name} </td></tr>
    //                         <tr><td><b>Description: </b></td><td>${feature.properties.building_type} </td></tr>
    //                         <tr><td><b>Region: </b></td><td> ${feature.properties.region} </td></tr>

    //                         <tr><td><b>Number of Flats: </b></td><td> ${feature.properties.num_flat} </td></tr>
    //                         <tr><td><b>Number of shops: </b></td><td> ${feature.properties.num_shops} </td></tr>
    //                         <tr><td><b>Number of Wings></td><td> ${feature.properties.wing_name} </td></tr>
    //                           <tr><td><b>Prabhag: </b></td><td> ${feature.properties.prabhag_no} </td></tr>
    //                         <tr><td><b>Ward: </b></td><td>${feature.properties.ward_name_field} </td></tr>

    //                         <tr><td><b>Village: </b></td><td> ${feature.properties.village} </td></tr>
    //                         <tr><td><b>Billing Address: </b></td><td>${feature.properties.address} </td></tr>
    //                         <tr><td><b>Property Address: </b></td><td>${feature.properties.prop_add} </td></tr>

    // `
    // +
    // `

    //      <tr ><td colspan =2><b><center><a href = '/buildedit/${feature.properties.sac_number}' class="btn btn-info">Update Building Details</a></center></td></tr>
    //      <tr ><td colspan =2 ><a href='/garbage_seg/' class="btn btn-success">Add Waste Segregation Details</a></td></tr></table>

    // `+`</table>

    )//layer.bindup popup closed
  }

function validate(id){
  let url_val = "/buildupdate/"+id+"-Auth";
  console.log(id,url_val)

  $.ajax({
        url: url_val,
        dataType: "json",
        type: "GET",
        success: function(data) {
          $('#validate').removeClass('btn-danger');
          $('#validate').addClass('btn-success');
        }
      })


  }

  var geojsonMarkerOptions = {
    radius: 6,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
  };
</script>
  <!-- var geojson_data = {{ geojson|safe }};-->
    <script>
  function displaypolygon(poly_layer){
    
    var geojson_data = {{ geojson|safe }};
    // console.log('GeoJSON Data:', geojson_data);
    // geojson_data.features.forEach(function(feature, index) {
    //   console.log('Feature ' + (index + 1) + ':', feature.properties.building_name);
    //   });
    console.log("Display ploygon function",poly_layer,"-",poly_layer.value)
    legend = L.control({position: 'bottomright'});
    let building_data;
    let building_data_up;
    let deficit_buildings;
    console.log("poly layer in display polygon is ",poly_layer)
    
    // Prabhag Editor has logged in 

    if(poly_layer.toString().length ==3) {
      // alert("in if part"+poly_layer);
      console.log("buildings is displayed for prabhag you have rights",poly_layer);
      if(poly_layer === '122')
        building_data = geojson_data2.features;
      if(poly_layer === '132')
        building_data = geojson_data.features;
        //geojson_data.features.forEach(function(feature, index) {
          //console.log('Feature ' + (index + 1) + ':', feature.properties.sac_number);
        //});
        
    }
    else {
    // Prabhag editor code ends 
      //  alert("in else part")
    if(poly_layer.value == '{s122buildingslege}' ){
     building_data = buildings.features;
    // alert(building_data)

    }
    if(poly_layer == '{buildings}' ){
      console.log("I am in displaypolygon")
      building_data = buildings.features;
    // console.log("Display Polygon building data",buildings.features)

    }
    else if(poly_layer=='{buildings_up}'){
      building_data_up= buildings_up.features;
    }
  }
  if(building_data !=undefined){
    console.log("building data counter is not undefined");
    var redcounter = 0;
    var greencounter = 0;
    var yellowcounter = 0;
    var orangecounter = 0;
    var greycounter = 0;
    var bluecounter = 0;
    totalcount = 0;
  
    polylayer = L.geoJSON(building_data, {
        pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions)},
        style:function(feature){
          if(feature.properties.validity == true){
            if(feature.properties.building_name != null & feature.properties.num_flat != null & feature.properties.address !=null &feature.properties.prop_add != null & feature.properties.building_type != null & feature.properties.wing_name !=null & feature.properties.num_shops != null & feature.properties.village != null){
              // if(feature.properties.building_name != null & feature.properties.uodated_by != null & feature.properties.address !=null &feature.properties.prop_add != null  ){
                greencounter++;
                
                return {color:"#000",fillColor:"green"};
            }
            else  if(feature.properties.building_name != null){
              yellowcounter++;
              return {color:"#000",fillColor:"yellow"};
            }
            totalcount++
            }
            // else if(feature.properties.validity == false){
            else{
              if((feature.properties.building_name !=null)&(feature.properties.is_bwg ==null || feature.properties.is_compost ==null )){
                greycounter++;
                totalcount++
                return {color:"#000",fillColor:"grey"};
              }
              else if(feature.properties.building_name ==null){
                redcounter++;
                totalcount++
                return {color:"#000",fillColor:"red"};
              }
              else if((feature.properties.building_name !=null)&(feature.properties.num_flat ==null|| feature.properties.population ==null|| feature.properties.region ==null || feature.properties.road_nm ==null || feature.properties.building_type ==null )){
                orangecounter++
                totalcount++
                return {color:"#000",fillColor:"orange"};
              }
            }
                  

          },    
         
        onEachFeature: onEachFeatureForPointBB,
      }); //polylayer L.geoJson closed

    legend = L.control({position: 'bottomright'});
    legend.onAdd = function(mymap) {
      var div = L.DomUtil.create("div", "legend");
      div.innerHTML += "<h3>Legend on basis of static details of ("+totalcount+") building points</h3><hr><br>";
      div.innerHTML += '<b>On basis of Authotization from Municipality Officer</b></span></li></ul><hr>';
      div.innerHTML += '<i style="background: green"></i><span>Complete and authorized data.</span>('+greencounter+')<br>';
      div.innerHTML += '<i style="background: yellow"></i><span>Incomplete and authorized data.</span>('+yellowcounter+')<br><br>';
      div.innerHTML += '<b>On basis of Survey conducted (unauthorised data)</b></span><hr>';
      div.innerHTML += '<i style="background: orange"></i><span>Basic static data available.</span>('+orangecounter+')<br>';
      div.innerHTML += '<i style="background: grey"></i><span>Building Name present and BWG /compost data unavailable.</span>('+greycounter+')<br>';
      div.innerHTML += '<i style="background: red"></i><span>Building name missing.</span>('+redcounter+')<br>';
      // div.innerHTML += '<i style="background: blue"></i><span>Region name is null</span>('+bluecounter+')<br>';
      
      let btn = document.createElement("button");
      btn.innerHTML = "View as table";
      btn.id = "formBtn";

      btn.onclick = function () {
        let url_val = "/table/"+poly_layer+prabhag;
        window.location.href = url_val;
        };
      if(('{{ request.user.role }}'=='MO') || ('{{ request.user.username }}'=='riteshhhyadav248')){
       div.appendChild(btn);
       }
    return div;
    };
    // console.log(legend,"legend");
    legend.addTo(mymap);
    setView1('geonode:Buildings_mumbai','prabhag_no', prabhag);
    polylayer.addTo(mymap);
    }
  else if(building_data == undefined){
    // alert("building data undefined")
    console.log("building data counter is ACTUALLY undefined")
    polylayer = {};
    legend = L.control({position: 'bottomright'});
    legend.onAdd = function(mymap) {
      var div = L.DomUtil.create("div", "legend");
      div.innerHTML += "<h4>No Data updated yesterday.</h4>";
      // div += '<button style="background: #FFFFFF"></i><span>Ice</span><br>';
      // div.innerHTML += '<i class="icon" style="background-image: url(https://d30y9cdsu7xlg0.cloudfront.net/png/194515-200.png);background-repeat: no-repeat;"></i><span>Grænse</span><br>';
     return div;
    };

    legend.addTo(mymap);
    setView1('geonode:Buildings_mumbai','prabhag_no', prabhag);
    polylayer.addTo(mymap);
  }
  else if(poly_layer == '{buildings_noname}'){
    polylayer = L.geoJSON(osm_buildings,{
        pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng, geojsonMarkerOptions)},
        style:function(feature){
        switch(feature.properties.building_type){
            case 'residence':return {color:"#000",fillColor:"red"
        };
            case 'RESIDENTIAL':return {color:"#000",fillColor:"red",baseSize:10};
            case 'apartments':return {color:"#000",fillColor:"red"};
            // case 'yes':return {color:"#c83daa"};
            case 'commercial':return {color:"#000",fillColor:"#55e232"};
            case 'COMMERCIAL':return {color:"#000",fillColor:"#55e232"};
            case 'office':return {color:"#000",fillColor:"#7d3fe9"};
            case 'yes':return {color:"#000",fillColor:"#c83daa"};
            case 'school':return {color:"#000",fillColor:"#efe115"};
            }
        },    
        
    
        onEachFeature: onEachFeatureForUpdationK_west,
    });
  }
  else if(poly_layer =="{regions_noname}"){
    polylayer = L.geoJSON(osm_buildings, 
    {style:function(feature){
        switch(feature.properties.building_type){
            case 'residence':return {color:"#FF0000"};
            case 'residential':return {color:"#FF0000"};
            case 'apartments':return {color:"#FF0000"};
            // case 'yes':return {color:"#c83daa"};
            case 'commercial':return {color:"#FF0000"};
            case 'Commercial':return {color:"#FF0000"};
            case 'office':return {color:"#FF0000"};
            case 'yes':return {color:"#FF0000"};
            case 'school':return {color:"#FF0000"};
            }
        },    
        
        onEachFeature: onEachFeatureForPointBB,
        filter: NonameRegionFilter,
    // }).addTo(mymap);
    });
  }

}
function addWMSLegend(layer) {
  
    lagendGraphic = "https://geonode.communitygis.in/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=" + layer + "&LEGEND_OPTIONS=forceLabels:on&legend_options=countMatched:true&forceTitles:on";
    wms_legend = L.wmsLegend(lagendGraphic);
          
}

function addWMSLegendfromgeo(layer, style, cql) {
  console.log("cwl is "+cql)  
  
  var legendGraphicUrl = "https://geonode.communitygis.in/geoserver/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=" + layer + "&STYLE=" + style;
  console.log("legend url 1:" + legendGraphicUrl);
  // If a CQL filter is provided, add it to the legend URL
  if (cql) {
    // alert("cql is there")
    // legendGraphicUrl += "&CQL_FILTER=" + encodeURIComponent(cql);
    legendGraphicUrl += "&CQL_FILTER=" + cql;
  }
  
  
  console.log("legend url " + legendGraphicUrl);
  
  // Remove the existing legend if any
  if (wms_legend) {
    mymap.removeControl(wms_legend);
  }

  // Create a new legend control
  var legend = L.control({ position: 'topright' });

  // Define the onAdd method to populate the legend
  legend.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'info legend');
    div.innerHTML = '<img src="' + legendGraphicUrl + '" alt="legend">';
    return div;
  };

  // Add the legend to the map
  legend.addTo(mymap);
  
  // Store the reference to the legend control
  wms_legend = legend;
}

function NonameBuildingFilter(feature) {
// alert(layer.properties.name+"="+feature);
// layer.on({click:onClick })
  if(feature.properties.building_name !== null) 
    return false    
  else
    return true
}
function NonameRegionFilter(feature){
    if(feature.properties.region !== null)
        return false
    else    
        return true
}
var feature;
var $name,content ;
   
function Identify(e) {
 
    // set parameters needed for GetFeatureInfo WMS request
    var sw = mymap.options.crs.project(mymap.getBounds().getSouthWest());
    var ne = mymap.options.crs.project(mymap.getBounds().getNorthEast());
    var BBOX = sw.x + "," + sw.y + "," + ne.x + "," + ne.y;
    var WIDTH = mymap.getSize().x;
    var HEIGHT = mymap.getSize().y;

    var X = Math.trunc(mymap.layerPointToContainerPoint(e.layerPoint).x);
    var Y = Math.trunc(mymap.layerPointToContainerPoint(e.layerPoint).y);

    // compose the URL for the request
    
    
    var URL = popup_layer + '&BBOX=' + BBOX + '&FEATURE_COUNT=1&HEIGHT=' + HEIGHT + '&WIDTH=' + WIDTH + '&INFO_FORMAT=application%2Fjson&TILED=false&CRS=EPSG%3A3857&I=' + X + '&J=' + Y;
    //send GetFeatureInfo as asynchronous HTTP request using jQuery $.ajax
    console.log("click",popup_layer,layer1)
    $.ajax({
        url: URL,
        dataType: "json",
        type: "GET",
        success: function(data) {
          // alert("success-"+data.features.length)
          
          if (data.features.length !== 0) { // at least one feature returned in response
                var feature = data.features[0]; // first feature from response
                // Set up popup for clicked feature and open it
                // alert(feature.properties.slum_area)
                var popup = new L.Popup({
                    maxWidth: 300
                });
                console.log("in identify function "+layer1.value);
                if ((feature.properties.seg_done) && ((layer1.value == '{Rsegdone}')  || (layer1.value == '{Rsegquality}') || (layer1.value == '{Rsegcons}') || (layer1.value == '{Rsegfreq}')||(layer1.value != '{segdone}')  || (layer1.value != '{segquality}') || (layer1.value != '{segcons}') || (layer1.value != '{segfreq}') || (layer1.value != '{description}'))){
                    // alert("in R seg popup"+layer1.value);
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> Segregation Information</b></td><td></td></tr>" +
                      "<tr style ='border: 1px solid white'><td><b>Region Name: </b></td><td style ='text-align:left;'>" + feature.properties.region + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Population (approx): </b></td><td style ='text-align:left;'>" + feature.properties.population + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Is Segregation Done: </b></td><td style ='text-align:left;'>" + feature.properties.seg_done + "</td></tr>"+  
                      "<tr style ='border: 1px solid white'><td><b>Consistency of segregation: </b></td><td style ='text-align:left;'>" + feature.properties.consistenc + "</td></tr>"+  
                      "<tr style ='border: 1px solid white'><td><b>Frequency of Waste Pickup : </b></td><td style ='text-align:left;'>" + feature.properties.frequency + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Quality of Segregated Waste: </b></td><td style ='text-align:left;'>" + feature.properties.seg_qualit + "</td></tr>"+
                      
                        // "<tr style ='border: 1px solid white'><td><b>Area of Garden : </b></td><td>" + feature.properties.Area + "(sq. meters)</td></tr>"+
                        "</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                if(layer1.value == '{slum_boundaries}'){
                        var content = "<table class='popupclass' style='border: 1px solid white'><tr style='border: 1px solid white'><td colspan=6><b> Slum Information</b></td><td></td></tr>" +
                        "<tr style='border: 1px solid white'><td><b>Ward Name: </b></td><td style='text-align:left;'>" + feature.properties.ward_nm + "</td></tr>" +
                        "<tr style='border: 1px solid white'><td><b>Slum Name: </b></td><td style='text-align:left;'>" + feature.properties.slum_area + "</td></tr>" +
                        "<tr style='border: 1px solid white'><td><b>Cluster Id: </b></td><td style='text-align:left;'>" + feature.properties.cluster_id + "</td></tr>" +
                        
                        "</table>";
                    popup.setContent(content); // Set the content of the popup
                    popup.setLatLng(e.latlng); // Set the position of the popup
                    mymap.openPopup(popup); // Open the popup on the map
                    }
                 
                
                    if ((feature.properties.seg_done) && ((layer1.value == '{segdone}')  || (layer1.value == '{segquality}') || (layer1.value == '{segcons}') || (layer1.value == '{segfreq}') || (layer1.value == '{description}') )){
                    // alert("in seg popup"+layer1.value);
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> Segregation Information</b></td><td></td></tr>" +
                      "<tr style ='border: 1px solid white'><td><b>Building Name: </b></td><td style ='text-align:left;'>" + feature.properties.building_n + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Population (approx): </b></td><td style ='text-align:left;'>" + feature.properties.population + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Is Segregation Done: </b></td><td style ='text-align:left;'>" + feature.properties.seg_done + "</td></tr>"+  
                      "<tr style ='border: 1px solid white'><td><b>Consistency of segregation: </b></td><td style ='text-align:left;'>" + feature.properties.consistenc + "</td></tr>"+  
                      "<tr style ='border: 1px solid white'><td><b>Frequency of Waste Pickup : </b></td><td style ='text-align:left;'>" + feature.properties.frequency + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Quality of Segregated Waste: </b></td><td style ='text-align:left;'>" + feature.properties.seg_qualit + "</td></tr>"+
                      "<tr style ='border: 1px solid white'><td><b>Building Description: </b></td><td style ='text-align:left;'>" + feature.properties.descriptio + "</td></tr>"+
                        // "<tr style ='border: 1px solid white'><td><b>Area of Garden : </b></td><td>" + feature.properties.Area + "(sq. meters)</td></tr>"+
                        "</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                if (feature.properties.name && feature.properties.photo && !feature.properties.Username) {
                    // alert("in route popup");
                    // alert(HttpRequest.get_full_path())
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> Dumping point Information</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td><b>Near : </b></td><td style ='text-align:left;'>" + feature.properties.name + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Photo: </b></td><td><img class = 'popupimage' src= '../media/original_images/"+feature.properties.photo +"' alt='image not found - '>" +  feature.properties.photo+"</td></tr>"+
                        "</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                    if (feature.properties.Area) {
                    // alert("in route popup");
                    if(feature.properties.name != null)
                          gardenName = feature.properties.name 
                      else
                          gardenName = feature.properties.garden_n
                        
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> Garden Information</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td><b>Garden Name: </b></td><td style ='text-align:left;'>" + gardenName+ "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Area of Garden : </b></td><td>" + feature.properties.Area + "(sq. meters)</td></tr>"+
                        "</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                    
                    if (feature.properties.plastic_wa) {
                    // alert("in route popup");
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> Plastic Segregating Buildings Info</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td><b>Buildings Name : </b></td><td style ='text-align:left;'>" + feature.properties.plastic_wa + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Approx weight of plastic collected : </b></td><td>" + feature.properties.descriptio + "(kgs)</td></tr>"+
                        "</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                    // if (feature.properties.Area) {
                    // // alert("in route popup");
                    // content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> Garden Information</b></td><td></td></tr>" +
                    //     "<tr style ='border: 1px solid white'><td><b>Garden Name: </b></td><td style ='text-align:left;'>" + feature.properties.name + "</td></tr>"+
                    //     "<tr style ='border: 1px solid white'><td><b>Area of Garden : </b></td><td>" + feature.properties.Area + "(sq. meters)</td></tr>"+
                    //     "</table>";
                    // popup.setContent(content);
                    // popup.setLatLng(e.latlng);
                    // mymap.openPopup(popup);
                    // }
                if (feature.properties.photo && feature.properties.Username) {
                  var ext = ".jpeg";
                    // alert("in route popup");
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b>HBT Clinic Information</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td><b>HBT Name: </b></td><td style ='text-align:left;'>" + feature.properties.name + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Ward Name : </b></td><td>" + feature.properties.ward_nm + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Address: </b></td><td>" + feature.properties.address + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Uploaded By: </b></td><td>" + feature.properties.Username + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Date of capture: </b></td><td>" + feature.properties.date + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Photo Path: </b></td><td>" + feature.properties.photo + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Photo: </b></td><td><img class = 'popupimage' src='../media/original_images/".concat(feature.properties.photo)+ext+"' alt='image not found  '>" + "</td></tr>"+"</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                  if (feature.descriptio) {
                    // alert("in iitb buildings");
                    content = "<table class = 'popupclass' ><tr><td><b>IIT-B buildings Info</b></td><td></td></tr>" +
                        "<tr><td><b>Name: </b></td><td>" + feature.name + "</td></tr>";
                        "<tr><td><b>Descriptiom: </b></td><td>" + feature.descriptio + "</td></tr>"+"</table>";
                    // popup.setContent(content);
                    // popup.setLatLng(e.latlng);
                    // mymap.openPopup(popup);
                    // return content;
                  }
                if (feature.properties.route_nm) {
                    // alert("in route popup");
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b> BMC Route Information</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td><b>Route Name: </b></td><td style ='text-align:left;'>" + feature.properties.route_nm + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Prabhag : </b></td><td>" + feature.properties.prabhag_no + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Road Name: </b></td><td>" + feature.properties.road_nm + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Uploaded By: </b></td><td>" + feature.properties.qfield_un + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Date of capture: </b></td><td>" + feature.properties.date + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Image Name: </b></td><td>" + feature.properties.photo + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Photo: </b></td><td><img class = 'popupimage' src='../media/field_images/".concat(feature.properties.photo)+".jpeg"+"' alt='image not found - '>" + "</td></tr>"+"</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                if (feature.properties.bldg_nm) {
                    // alert("in compost popup");
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b>Compost Facility Information</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td><b>Ward Name: </b></td><td style ='text-align:left;'>" + feature.properties.ward_nm + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Prabhag : </b></td><td>" + feature.properties.prabhag_no + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Building Name: </b></td><td>" + feature.properties.bldg_nm + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Status: </b></td><td>" + feature.properties.status + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td><b>Type: </b></td><td>" + feature.properties.type + "</td></tr>"+"</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                if (feature.properties.daily_wast) {
                    // alert("in region");
                    content = "<table class = 'popupclass'style ='border: 1px solid white' ><tr style ='border: 1px solid white'><td colspan=6><b>Bulk Waste Generator Info</b></td><td></td></tr>" +
                        "<tr style ='border: 1px solid white'><td colspan=3><b>Ward Name: </b></td><td style ='text-align:left;'>" + feature.properties.Ward_name + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td colspan=3><b>Address: </b></td><td>" + feature.properties.full_addre + "</td></tr>"+
                        "<tr style ='border: 1px solid white'><td colspan=3><b>Daily Waste: </b></td><td>" + feature.properties.daily_wast + "</td></tr>"+"</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                    }
                if(layer1=="geonode:k-west_building"){
                  // console.log(feature)
                  content= `<table border =2><tr class="bg-primary"><td colspan=2>Building Information</td></tr>
                    <tr class="table-danger"><td>SAC Number:</td><td> ${feature.properties.sac_no}</td></tr>
                    <tr><td>Building Name:</td><td> ${feature.properties.building_n}</td></tr>
                    <tr class="table-danger"><td>Building Type :</td><td>${feature.properties.building_t}</td></tr>

                    <tr><td>Property Address:</td><td>${feature.properties.prop_blng_}</td></tr>
                    <tr class="table-danger"><td>Village:</td><td>${feature.properties.village}</td></tr>
                    <tr><td>Address : </td><td>${feature.properties.address}</td></tr>
                    </table>`
                  popup.setContent(content);
                  popup.setLatLng(e.latlng);
                  mymap.openPopup(popup);
                }
                if (feature.properties.region_nm && layer1.value == '{122regions}') {
                
                  // alert("in region");
                  content = "<table class = 'popupclass' ><tr><td><b>Region Info</b></td><td></td></tr>" +
                    "<tr style ='border: 1px solid white'><td><b>Ward: </b></td><td>" + feature.properties.ward_nm + "</td></tr>"+
                    "<tr style ='border: 1px solid white'><td><b>Prabhag: </b></td><td>" + feature.properties.prabhag_no + "</td></tr>"+
                    "<tr style ='border: 1px solid white'><td><b>Region Name: </b></td><td>" + feature.properties.region_nm + "</td></tr>"+"</table>";
                    popup.setContent(content);
                    popup.setLatLng(e.latlng);
                    mymap.openPopup(popup);
                }
                if((feature.properties.building_t) && ((layer1=='geonode:Buildings_mumbai')||(layer1.value=='{s122buildings}') ||(layer1.value=='{sbuildings}')||(layer1.value=='{nbuildings}') || (layer1.value=='{l156buildings}' || layer1.value=='{l157buildings}')|| layer1.value=='{s121iitbbuildings}') || (layer1.value =='{s122buildings}') ||(layer1.value ==null && layer1!= null)){
                  // alert("in building info"+layer1.value)
                  $name= {         
                  'name': feature.properties.sac_number}
                    new_ajax(e);
                        
            // Set up popup for clicked feature and open it
                }
                
          }
        }
      
    });
  
  
   

}
function new_ajax(e){
  var $endpoint = window.location.href // or localhost/interface
  var popup = new L.Popup({
                    maxWidth: 300
                });
  $.ajax({
                method: "GET",
                url: $endpoint,
                data: $name,
                success: function(data) {
                  
                  if (data.region) {
                    // alert("in region");
                    content = "<table class = 'popupclass' ><tr><td><b>Region Info</b></td><td></td></tr>" +
                        "<tr><td><b>Region Name: </b></td><td>" + data.region + "</td></tr>"+"</table>";
                    // popup.setContent(content);
                    // popup.setLatLng(e.latlng);
                    // mymap.openPopup(popup);
                    // return content;
                  }
                  if (data.descriptio) {
                    // alert("in iitb buildings");
                    content = "<table class = 'popupclass' ><tr><td><b>IIT-B buildings Info</b></td><td></td></tr>" +
                        "<tr><td><b>Name: </b></td><td>" + data.name + "</td></tr>";
                        "<tr><td><b>Descriptipm: </b></td><td>" + data.descriptio + "</td></tr>"+"</table>";
                    // popup.setContent(content);
                    // popup.setLatLng(e.latlng);
                    // mymap.openPopup(popup);
                    // return content;
                  }
                
               
                if (data.building_type) {
                  if(data.building_type== 'R' || data.building_type== 'r'||data.building_type== 'Residential'||data.building_type== 'residential'){
                    buil_type = 'Residential'}
                  else if (data.building_type== 'Commercial'||data.building_type== 'C' || data.building_type== 'c'){
                    buil_type = 'Commercial'}
                  else if (data.building_type== 'I'){
                    buil_type = 'Industrial'}
                  else 
                     buil_type = data.building_type 


                    content = "<table class = 'popupclass' ><tr><td><b>Buildings Info</b></td><td></td></tr>" +
                        "<tr><td><b>SAC No.: </b></td><td>" + data.sac_number + "</td></tr>"+
                        "<tr><td><b>Building Name: </b></td><td>" + data.building_name + "</td></tr>"+
                        "<tr><td><b>Description: </b></td><td>"+data.building_type + "</td></tr>"+
                        "<tr><td><b>Road: </b></td><td>"+data.road + "</td></tr>"+
                        "<tr><td><b>Region: </b></td><td>" + data.region + "</td></tr>"+
                        "<tr><td><b>Bwg : </b></td><td>" + data.is_bwg + "</td></tr>"+
                        "<tr><td><b>Bwg Type: </b></td><td>" + data.bwg_type + "</td></tr>"+
                        "<tr><td><b>Composting: </b></td><td>" + data.is_compost + "</td></tr>"+
                        "<tr><td><b>Composting Type : </b></td><td>" + data.compost_type + "</td></tr>"+
                        "<tr><td><b>Number of Floors: </b></td><td>" + data.num_floors + "</td></tr>"+
                        "<tr><td><b>Number of Flats: </b></td><td>" + data.num_flat + "</td></tr>"+
                        "<tr><td><b>Number of shops: </b></td><td>" + data.num_shops + "</td></tr>"+
                        "<tr><td><b>Wing Name</td><td>" + data.wing_name + "</td></tr>"+
                        "<tr><td><b>Village: </b></td><td>" + data.village + "</td></tr>"+
                        "<tr><td><b>Property Address: </b></td><td>" + data.address + "</td></tr>"+
                        "<tr><td><b>Population: </b></td><td>" +  data.population + "</td></tr>"+
                        "<tr><td><b>Remarks: </b></td><td>" + data.remarks + "</td></tr>"+
                        "<tr><td><b>Updated by: </b></td><td>" + data.updated_by + "</td></tr>"+
                        "<tr><td><b>Update Date/Time: </b></td><td>" + data.update_time + "</td></tr>"+
                        // "<tr><td><b>MODIFY: </b></td><td><a href = '/buildedit/"+data.osm_id+"' style ='color:#FF0000;'>" + data.osm_id + "</a></td></tr>"+
                        // "<tr><td rowspan=2><a href = '/buildedit/"+data.osm_id+"' style ='color:#FF0000;'>" + data.osm_id + "</a></td></tr>"+
                        "{% if request.user|has_group:'Editor' %}"+
                        "<tr ><td colspan =2><b><center><a href = '/buildedit/"+ data.sac_no + "' class='btn btn-info'>Update Building Details</a></center></td></tr>"+
                        "<tr ><td colspan =2 ><a href='/garbage_seg/' class='btn btn-success'>Add Waste Segregation Details</a></td></tr></table>"+
                          "{% endif%}"
                        "</table>";
            //  return content;
                }
                popup.setContent(content);
                popup.setLatLng(e.latlng);
                mymap.openPopup(popup);
            // $("#id_pic").val(data.picture.url);
        }
       ,
                error: handleFormError,
            })
  
}
 

        function handleFormError(jqXHR, textStatus, errorThrown) {
            console.log(jqXHR)
            console.log(textStatus)
            console.log(errorThrown)
        }
mymap.addEventListener('click', Identify);
    
</script>
      {% endautoescape %}
      {% endblock extra_map_javascript %}